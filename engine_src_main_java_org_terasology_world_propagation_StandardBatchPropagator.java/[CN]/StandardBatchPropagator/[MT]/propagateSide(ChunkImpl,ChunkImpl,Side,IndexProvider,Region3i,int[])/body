{
  Vector3i adjPos=new Vector3i();
  for (  Vector3i pos : edgeRegion) {
    int depthIndex=indexProvider.getIndexFor(pos);
    adjPos.set(pos);
    adjPos.add(chunkEdgeDeltas.get(side));
    byte expectedValue=(byte)(rules.getValue(chunk,pos) - 1);
    if (expectedValue < 1) {
      continue;
    }
    int depth=0;
    Block lastBlock=chunk.getBlock(pos);
    while (expectedValue > 0 && rules.canSpreadOutOf(lastBlock,side)) {
      byte adjValue=rules.getValue(adjChunk,adjPos);
      if (expectedValue > adjValue && adjValue != PropagatorWorldView.UNAVAILABLE) {
        lastBlock=adjChunk.getBlock(adjPos);
        if (rules.canSpreadInto(lastBlock,side.reverse())) {
          rules.setValue(adjChunk,adjPos,expectedValue);
          adjPos.add(side.getVector3i());
          depth++;
          expectedValue--;
        }
 else {
          expectedValue=0;
        }
      }
 else {
        expectedValue=0;
      }
    }
    depths[depthIndex]=depth;
  }
}
