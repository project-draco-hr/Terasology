{
  EntityRef someEntity=entityManager.create();
  EntityRef character=entityManager.create(new EntityRefComponent(someEntity));
  PlayerStore store=esm.createPlayerStoreForSave(PLAYER_ID);
  store.setCharacter(character);
  store.save();
  GlobalStore globalStore=esm.createGlobalStoreForSave();
  globalStore.store(someEntity);
  globalStore.save();
  esm.flush();
  EngineEntityManager newEntityManager=new EntitySystemBuilder().build(moduleManager,networkSystem);
  StorageManager newSM=new StorageManagerInternal(newEntityManager,false);
  newSM.loadGlobalStore();
  PlayerStore restored=newSM.loadPlayerStore(PLAYER_ID);
  restored.restoreEntities();
  assertTrue(restored.getCharacter().getComponent(EntityRefComponent.class).entityRef.exists());
}
