{
  _gameInstance=gameEngine;
  entityManager=new EntitySystemBuilder().build(CoreRegistry.get(ModManager.class),CoreRegistry.get(NetworkSystem.class));
  eventSystem=CoreRegistry.get(EventSystem.class);
  guiManager=CoreRegistry.get(GUIManager.class);
  componentSystemManager=new ComponentSystemManager();
  CoreRegistry.put(ComponentSystemManager.class,componentSystemManager);
  cameraTargetSystem=new CameraTargetSystem();
  CoreRegistry.put(CameraTargetSystem.class,cameraTargetSystem);
  componentSystemManager.register(cameraTargetSystem,"engine:CameraTargetSystem");
  inputSystem=new InputSystem();
  CoreRegistry.put(InputSystem.class,inputSystem);
  componentSystemManager.register(inputSystem,"engine:InputSystem");
  EntityRef localPlayerEntity=entityManager.create(new ClientComponent());
  LocalPlayer localPlayer=CoreRegistry.put(LocalPlayer.class,new LocalPlayer());
  localPlayer.setClientEntity(localPlayerEntity);
  componentSystemManager.initialise();
  playBackgroundMusic();
  guiManager.openWindow("main");
  if (!messageOnLoad.isEmpty()) {
    guiManager.showMessage("",messageOnLoad);
  }
}
