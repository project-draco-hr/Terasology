{
  if (blockFamily == null) {
    return EntityRef.NULL;
  }
  EntityRef entity=entityManager.create("engine:blockItemBase");
  if (blockFamily.getArchetypeBlock().getLuminance() > 0) {
    entity.addComponent(new LightComponent());
  }
  ItemComponent item=entity.getComponent(ItemComponent.class);
  item.name=blockFamily.getDisplayName();
  if (blockFamily.getArchetypeBlock().isStackable()) {
    item.stackId="block:" + blockFamily.getURI().toString();
    item.stackCount=(byte)quantity;
  }
  entity.saveComponent(item);
  BlockItemComponent blockItem=entity.getComponent(BlockItemComponent.class);
  blockItem.blockFamily=blockFamily;
  if (blockFamily.getArchetypeBlock().getEntityMode() == BlockEntityMode.PERSISTENT) {
    if (!placedEntity.exists()) {
      placedEntity=entityManager.create(blockFamily.getArchetypeBlock().getEntityPrefab());
      placedEntity.addComponent(new NetworkComponent());
    }
    blockItem.placedEntity=placedEntity;
  }
  entity.saveComponent(blockItem);
  return entity;
}
