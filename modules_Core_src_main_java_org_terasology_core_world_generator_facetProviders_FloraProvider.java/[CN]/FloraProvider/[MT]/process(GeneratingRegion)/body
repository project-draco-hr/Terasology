{
  FloraFacet facet=new FloraFacet(region.getRegion(),region.getBorderForFacet(FloraFacet.class));
  SeaLevelFacet seaLevel=region.getRegionFacet(SeaLevelFacet.class);
  SurfaceHeightFacet surface=region.getRegionFacet(SurfaceHeightFacet.class);
  DensityFacet density=region.getRegionFacet(DensityFacet.class);
  BiomeFacet biomeFacet=region.getRegionFacet(BiomeFacet.class);
  int minY=facet.getWorldRegion().minY();
  int maxY=facet.getWorldRegion().maxY();
  for (int z=facet.getRelativeRegion().minZ(); z <= facet.getRelativeRegion().maxZ(); ++z) {
    for (int x=facet.getRelativeRegion().minX(); x <= facet.getRelativeRegion().maxX(); ++x) {
      int height=TeraMath.floorToInt(surface.get(x,z)) + 1;
      if (height >= minY && height <= maxY && height > seaLevel.getSeaLevel()) {
        CoreBiome biome=biomeFacet.get(x,z);
        height=height - minY + facet.getRelativeRegion().minY();
        float below=density.get(x,height - 1,z);
        float curr=density.get(x,height,z);
        if (below >= 0 && curr < 0) {
          float plantProb=getPlantProb(biome);
          if (noiseTable.noise(x,z) / 255.0f < plantProb) {
            FloraType type=getType(x,z);
            facet.set(x,height,z,type);
          }
        }
      }
    }
  }
  region.setRegionFacet(FloraFacet.class,facet);
}
