{
  PlantFacet facet=new PlantFacet(region.getRegion(),region.getBorderForFacet(PlantFacet.class));
  SurfaceHeightFacet surface=region.getRegionFacet(SurfaceHeightFacet.class);
  DensityFacet density=region.getRegionFacet(DensityFacet.class);
  BiomeFacet biomeFacet=region.getRegionFacet(BiomeFacet.class);
  int minY=facet.getWorldRegion().minY();
  int maxY=facet.getWorldRegion().maxY();
  for (int z=facet.getRelativeRegion().minZ(); z <= facet.getRelativeRegion().maxZ(); ++z) {
    for (int x=facet.getRelativeRegion().minX(); x <= facet.getRelativeRegion().maxX(); ++x) {
      int height=TeraMath.ceilToInt(surface.get(x,z));
      if (height >= minY && height <= maxY) {
        CoreBiome biome=biomeFacet.get(x,z);
        height=height - minY + facet.getRelativeRegion().minY();
        float below=density.get(x,height - 1,z);
        float curr=density.get(x,height,z);
        if (below >= 0 && curr < 0) {
          float plantProb=getPlantProb(biome);
          if (noiseTable.noise(x,z) / 255.0f < plantProb) {
            facet.set(x,height,z,true);
          }
        }
      }
    }
  }
  region.setRegionFacet(PlantFacet.class,facet);
}
