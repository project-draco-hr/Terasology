{
  if (!contains(x,y,z))   throw new IndexOutOfBoundsException("Index out of bounds (" + x + ", "+ y+ ", "+ z+ ")");
  if (value < 0 || value > 15)   throw new IllegalArgumentException("Parameter 'value' has to be in the range 0 - 15 (" + value + ")");
  if (expected < 0 || expected > 15)   throw new IllegalArgumentException("Parameter 'expected' has to be in the range 0 - 15 (" + value + ")");
  int row=y * getSizeXZHalf(), pos=pos(x,z);
  if (pos < getSizeXZHalf()) {
    byte raw=data[row + pos];
    byte old=TeraArrays.getHi(raw);
    if (old == expected) {
      data[row + pos]=TeraArrays.setHi(raw,value);
      return true;
    }
    return false;
  }
  pos=pos - getSizeXZHalf();
  byte raw=data[row + pos];
  byte old=TeraArrays.getLo(raw);
  if (old == expected) {
    data[row + pos]=TeraArrays.setLo(raw,value);
    return true;
  }
  return false;
}
