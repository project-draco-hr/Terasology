{
  FastRandom random=new FastRandom(seed.hashCode() ^ (pos.x + 39L * (pos.y + 39L * pos.z)));
  for (int y=32; y < Chunk.SIZE_Y; y++) {
    for (int x=4; x < Chunk.SIZE_X; x+=4) {
      for (int z=4; z < Chunk.SIZE_Z; z+=4) {
        Vector3i worldPos=new Vector3i(pos);
        worldPos.mult(new Vector3i(Chunk.SIZE_X,Chunk.SIZE_Y,Chunk.SIZE_Z));
        worldPos.add(x,y,z);
        WorldBiomeProvider.Biome biome=biomeProvider.getBiomeAt(worldPos.x,worldPos.z);
        int randX=x + random.nextInt(-3,3);
        int randZ=z + random.nextInt(-3,3);
        Block posBlock=view.getBlock(randX,y,randZ);
        if (posBlock == null) {
          logger.error("WorldView.getBlock({}, {}, {}) return null, skipping forest generation (watchdog for issue #534)",randX,y,randZ);
          return;
        }
        if (posBlock.equals(sandBlock) || posBlock.equals(grassBlock) || posBlock.equals(snowBlock)) {
          TreeGenerator treeGen=random.nextItem(treeGenerators.get(biome));
          if (treeGen != null && random.nextDouble() < treeGen.getGenerationProbability()) {
            generateTree(view,treeGen,randX,y,randZ,random);
          }
        }
      }
    }
  }
}
