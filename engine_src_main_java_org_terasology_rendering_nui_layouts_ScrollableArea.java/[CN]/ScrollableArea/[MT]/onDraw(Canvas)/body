{
  int contentHeight=canvas.calculateRestrictedSize(content,new Vector2i(canvas.size().x,Integer.MAX_VALUE)).y;
  if (canvas.size().y < contentHeight) {
    int scrollbarWidth=canvas.calculateRestrictedSize(scrollbar,canvas.size()).x;
    contentHeight=canvas.calculateRestrictedSize(content,new Vector2i(canvas.size().x - scrollbarWidth,Integer.MAX_VALUE)).y;
    boolean atBottom=scrollbar.getRange() == scrollbar.getValue();
    Rect2i contentRegion=Rect2i.createFromMinAndSize(0,0,canvas.size().x - scrollbarWidth,canvas.size().y);
    scrollbar.setRange(contentHeight - contentRegion.height());
    if ((stickToBottom && atBottom) || moveToBottomPending) {
      scrollbar.setValue(scrollbar.getRange());
      moveToBottomPending=false;
    }
    if (moveToTopPending) {
      scrollbar.setValue(0);
      moveToTopPending=false;
    }
    canvas.addInteractionRegion(scrollListener);
    canvas.drawWidget(scrollbar,Rect2i.createFromMinAndSize(canvas.size().x - scrollbarWidth,0,scrollbarWidth,canvas.size().y));
    try (SubRegion ignored=canvas.subRegion(contentRegion,true)){
      canvas.drawWidget(content,Rect2i.createFromMinAndSize(0,-scrollbar.getValue(),canvas.size().x,contentHeight));
    }
   }
 else {
    canvas.drawWidget(content);
  }
}
