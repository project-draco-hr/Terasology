{
  mockTime=mock(EngineTime.class);
  CoreRegistry.put(Time.class,mockTime);
  networkSystem=new NetworkSystemImpl(mockTime);
  CoreRegistry.put(NetworkSystem.class,networkSystem);
  engineEntityManager=new EntitySystemBuilder().build(CoreRegistry.get(ModuleManager.class),networkSystem);
  CoreRegistry.put(StorageManager.class,new StorageManagerInternal(engineEntityManager));
  componentSystemManager=new ComponentSystemManager();
  CoreRegistry.put(ComponentSystemManager.class,componentSystemManager);
  LoadPrefabs prefabLoadStep=new LoadPrefabs();
  boolean complete=false;
  prefabLoadStep.begin();
  while (!complete) {
    complete=prefabLoadStep.step();
  }
  CoreRegistry.get(ComponentSystemManager.class).initialise();
}
