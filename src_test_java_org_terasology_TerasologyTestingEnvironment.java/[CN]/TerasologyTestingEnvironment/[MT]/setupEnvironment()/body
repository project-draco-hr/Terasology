{
  PathManager.getInstance().useOverrideHomePath(new File("unittesthome"));
  if (!setup) {
    setup=true;
    bindLwjgl();
    modManager=new ModManager();
    modManager.applyActiveMods();
    CoreRegistry.put(ModManager.class,modManager);
    AssetType.registerAssetTypes();
    AssetManager.getInstance().addAssetSource(new ClasspathSource(ModManager.ENGINE_PACKAGE,Terasology.class.getProtectionDomain().getCodeSource(),ModManager.ASSETS_SUBDIRECTORY,ModManager.OVERRIDES_SUBDIRECTORY));
    AssetManager.getInstance().addAssetSource(new ClasspathSource("unittest",TerasologyTestingEnvironment.class.getProtectionDomain().getCodeSource(),ModManager.ASSETS_SUBDIRECTORY,ModManager.OVERRIDES_SUBDIRECTORY));
    DefaultBlockFamilyFactoryRegistry blockFamilyFactoryRegistry=new DefaultBlockFamilyFactoryRegistry();
    blockFamilyFactoryRegistry.setBlockFamilyFactory("horizontal",new HorizontalBlockFamilyFactory());
    blockFamilyFactoryRegistry.setBlockFamilyFactory("alignToSurface",new AlignToSurfaceFamilyFactory());
    blockManager=new BlockManagerImpl(blockFamilyFactoryRegistry);
    CoreRegistry.put(BlockManager.class,blockManager);
    config=new Config();
    CoreRegistry.put(Config.class,config);
    audioManager=new NullAudioManager();
    CoreRegistry.put(AudioManager.class,audioManager);
    Display.setDisplayMode(new DisplayMode(0,0));
    Display.create(CoreRegistry.get(Config.class).getRendering().getPixelFormat());
    collisionGroupManager=new CollisionGroupManager();
    CoreRegistry.put(CollisionGroupManager.class,collisionGroupManager);
  }
 else {
    CoreRegistry.put(BlockManager.class,blockManager);
    CoreRegistry.put(Config.class,config);
    CoreRegistry.put(AudioManager.class,audioManager);
    CoreRegistry.put(CollisionGroupManager.class,collisionGroupManager);
    CoreRegistry.put(ModManager.class,modManager);
  }
  PathManager.getInstance().setCurrentSaveTitle("world1");
}
