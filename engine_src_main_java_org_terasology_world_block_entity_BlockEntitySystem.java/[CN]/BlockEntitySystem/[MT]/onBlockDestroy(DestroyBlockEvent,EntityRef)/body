{
  BlockDamageComponent blockDamageComponent=event.getDamageType().getComponent(BlockDamageComponent.class);
  float chanceOfBlockDrop=1;
  if (blockDamageComponent != null) {
    chanceOfBlockDrop=1 - blockDamageComponent.blockAnnihilationChance;
  }
  Vector3i location=getBlockLocation(entity);
  if (random.nextFloat() < chanceOfBlockDrop) {
    BlockFamily blockFamily=null;
    if (entity.hasComponent(BlockComponent.class)) {
      blockFamily=entity.getComponent(BlockComponent.class).getBlock().getBlockFamily();
    }
    BeforeBlockToItem beforeBlockToItemEvent=new BeforeBlockToItem(event.getDamageType(),event.getInstigator(),event.getTool(),blockFamily,1);
    entity.send(beforeBlockToItemEvent);
    if (!beforeBlockToItemEvent.isConsumed()) {
      for (      BlockFamily family : beforeBlockToItemEvent.getBlockItemsToGenerate()) {
        EntityRef item=blockItemFactory.newInstance(family,beforeBlockToItemEvent.getQuanityForBlock(family));
        entity.send(new OnBlockToItem(item));
        if (family.getArchetypeBlock().isDirectPickup()) {
          if (!inventoryManager.giveItem(event.getInstigator(),item)) {
            processDropping(item,location);
          }
        }
 else {
          processDropping(item,location);
        }
      }
      for (      EntityRef item : beforeBlockToItemEvent.getItemsToDrop()) {
        processDropping(item,location);
      }
    }
  }
  BlockRegionComponent blockRegionComp=entity.getComponent(BlockRegionComponent.class);
  if (blockRegionComp != null) {
    for (    Vector3i blockPosition : blockRegionComp.region) {
      worldProvider.setBlock(blockPosition,BlockManager.getAir());
    }
    entity.destroy();
  }
 else {
    worldProvider.setBlock(location,BlockManager.getAir());
  }
}
