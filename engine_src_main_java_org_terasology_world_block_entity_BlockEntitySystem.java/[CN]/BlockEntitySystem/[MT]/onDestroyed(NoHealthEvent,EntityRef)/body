{
  BlockComponent blockComp=entity.getComponent(BlockComponent.class);
  Block oldBlock=worldProvider.getBlock(blockComp.getPosition());
  BlockDamageComponent blockDamageComponent=event.getDamageType().getComponent(BlockDamageComponent.class);
  Block upperBlock=worldProvider.getBlock(blockComp.getPosition().x,blockComp.getPosition().y + 1,blockComp.getPosition().z);
  if (upperBlock.isSupportRequired()) {
    worldProvider.setBlock(new Vector3i(blockComp.getPosition().x,blockComp.getPosition().y + 1,blockComp.getPosition().z),BlockManager.getAir());
  }
  if (blockDamageComponent == null || !blockDamageComponent.skipPerBlockEffects) {
    entity.send(new PlaySoundEvent(Assets.getSound("engine:RemoveBlock"),0.6f));
  }
  float chanceOfBlockDrop=1;
  if (blockDamageComponent != null) {
    chanceOfBlockDrop=1 - blockDamageComponent.blockAnnihilationChance;
  }
  if (random.nextFloat() < chanceOfBlockDrop) {
    BeforeBlockToItem beforeBlockToItemEvent=new BeforeBlockToItem(oldBlock.getBlockFamily(),1);
    entity.send(beforeBlockToItemEvent);
    if (!beforeBlockToItemEvent.isConsumed()) {
      for (      BlockFamily family : beforeBlockToItemEvent.getBlockItemsToGenerate()) {
        EntityRef item=blockItemFactory.newInstance(family,beforeBlockToItemEvent.getQuanityForItem(family));
        entity.send(new OnBlockToItem(item));
        if ((family.getArchetypeBlock().isDirectPickup())) {
          if (!inventoryManager.giveItem(event.getInstigator(),item)) {
            EntityRef pickup=pickupBuilder.createPickupFor(item,blockComp.getPosition().toVector3f(),20);
            pickup.send(new ImpulseEvent(random.nextVector3f(30.0f)));
          }
        }
 else {
          EntityRef pickup=pickupBuilder.createPickupFor(item,blockComp.getPosition().toVector3f(),20);
          pickup.send(new ImpulseEvent(random.nextVector3f(30.0f)));
        }
      }
    }
  }
  worldProvider.setBlock(blockComp.getPosition(),BlockManager.getAir());
}
