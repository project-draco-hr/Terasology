{
  if (!target.exists() && targetBlockPos != null) {
    target=blockRegistry.getOrCreateEntityAt(targetBlockPos);
  }
  boolean lostTarget=false;
  if (!target.exists()) {
    targetBlockPos=null;
    lostTarget=true;
  }
  Camera camera=CoreRegistry.get(WorldRenderer.class).getActiveCamera();
  RayBlockIntersection.Intersection hitInfo=BlockRaytracer.trace(camera.getPosition(),camera.getViewingDirection(),worldProvider);
  Vector3i newBlockPos=(hitInfo != null) ? hitInfo.getBlockPosition() : null;
  if (!Objects.equal(targetBlockPos,newBlockPos) || lostTarget) {
    EntityRef oldTarget=target;
    target=EntityRef.NULL;
    targetBlockPos=newBlockPos;
    if (newBlockPos != null) {
      target=blockRegistry.getOrCreateEntityAt(targetBlockPos);
    }
    oldTarget.send(new CameraOutEvent());
    target.send(new CameraOverEvent());
    localPlayer.getEntity().send(new CameraTargetChangedEvent(oldTarget,target));
  }
}
