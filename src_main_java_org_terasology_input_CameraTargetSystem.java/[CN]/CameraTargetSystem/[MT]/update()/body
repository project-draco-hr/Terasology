{
  if (!target.exists() && targetBlockPos != null) {
    target=blockRegistry.getOrCreateEntityAt(targetBlockPos);
  }
  boolean lostTarget=false;
  if (!target.exists()) {
    targetBlockPos=null;
    lostTarget=true;
  }
  Camera camera=CoreRegistry.get(WorldRenderer.class).getActiveCamera();
  BulletPhysicsRenderer physicsRenderer=CoreRegistry.get(BulletPhysicsRenderer.class);
  HitResult hitInfo=physicsRenderer.rayTrace(new Vector3f(camera.getPosition()),new Vector3f(camera.getViewingDirection()),TARGET_DISTANCE);
  Vector3i newBlockPos=null;
  if (hitInfo.isHit()) {
    hitPosition=hitInfo.getHitPoint();
    hitNormal=hitInfo.getHitNormal();
    BlockComponent blockComp=hitInfo.getEntity().getComponent(BlockComponent.class);
    if (blockComp != null) {
      newBlockPos=new Vector3i(blockComp.getPosition());
    }
  }
  if (!Objects.equal(targetBlockPos,newBlockPos) || lostTarget) {
    EntityRef oldTarget=target;
    target=EntityRef.NULL;
    targetBlockPos=newBlockPos;
    if (newBlockPos != null) {
      target=hitInfo.getEntity();
    }
    oldTarget.send(new CameraOutEvent());
    target.send(new CameraOverEvent());
    localPlayer.getEntity().send(new CameraTargetChangedEvent(oldTarget,target));
  }
}
