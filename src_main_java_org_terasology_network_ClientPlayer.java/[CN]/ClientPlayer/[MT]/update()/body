{
  TIntIterator initialIterator=netInitial.iterator();
  while (initialIterator.hasNext()) {
    int netId=initialIterator.next();
    netRelevant.add(netId);
    EntityRef entity=networkSystem.getEntity(netId);
    EntityData.Entity entityData=entitySerializer.serialize(entity,new NetworkComponentFieldCheck());
    NetData.NetMessage message=NetData.NetMessage.newBuilder().setType(NetData.NetMessage.Type.CREATE_ENTITY).setCreateEntity(NetData.CreateEntityMessage.newBuilder().setEntity(entityData)).build();
    send(message);
  }
  TIntIterator dirtyIterator=netDirty.iterator();
  while (dirtyIterator.hasNext()) {
    int netId=dirtyIterator.next();
    EntityRef entity=networkSystem.getEntity(netId);
    EntityData.Entity entityData=entitySerializer.serialize(entity,false,new NetworkComponentFieldCheck());
    NetData.NetMessage message=NetData.NetMessage.newBuilder().setType(NetData.NetMessage.Type.UPDATE_ENTITY).setUpdateEntity(NetData.UpdateEntityMessage.newBuilder().setEntity(entityData).setNetId(netId)).build();
    send(message);
  }
  netInitial.clear();
  netDirty.clear();
  processEvents();
}
