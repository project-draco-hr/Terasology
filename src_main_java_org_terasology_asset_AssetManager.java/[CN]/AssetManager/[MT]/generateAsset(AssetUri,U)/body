{
  if (data instanceof CompatibilityHackAsset) {
    return (Asset)data;
  }
  AssetFactory assetFactory=factories.get(uri.getAssetType());
  if (assetFactory == null) {
    logger.warn("Unsupported asset type: {}",uri.getAssetType());
    return null;
  }
  Asset asset=assetCache.get(uri);
  if (asset != null) {
    logger.info("Reloading {} with newly generated data",uri);
    asset.reload(data);
  }
 else {
    asset=assetFactory.buildAsset(uri,data);
    if (asset != null && !asset.isDisposed()) {
      assetCache.put(uri,asset);
    }
  }
  return asset;
}
