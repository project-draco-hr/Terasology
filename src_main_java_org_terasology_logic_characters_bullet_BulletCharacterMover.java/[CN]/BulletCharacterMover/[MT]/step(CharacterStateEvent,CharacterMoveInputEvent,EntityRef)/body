{
  CharacterMovementComponent characterMovementComponent=entity.getComponent(CharacterMovementComponent.class);
  CharacterStateEvent result=new CharacterStateEvent(initial);
  result.setSequenceNumber(input.getSequenceNumber());
  updatePosition(characterMovementComponent,result,input);
  result.setTime(initial.getTime() + input.getDeltaMs());
  if (result.getMode() != MovementMode.GHOSTING) {
    checkSwimming(characterMovementComponent,result);
  }
  updateRotation(characterMovementComponent,result,input);
  return result;
}
