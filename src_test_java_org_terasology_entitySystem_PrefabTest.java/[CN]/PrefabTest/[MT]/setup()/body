{
  ModuleManager moduleManager=new ModuleManagerImpl();
  moduleManager.applyActiveModules();
  AssetManager assetManager=new AssetManager(moduleManager);
  CoreRegistry.put(ModuleManager.class,moduleManager);
  CoreRegistry.put(AssetManager.class,assetManager);
  AssetType.registerAssetTypes(assetManager);
  URL url=getClass().getClassLoader().getResource("testResources");
  url=new URL(url.toString().substring(0,url.toString().length() - "testResources".length() - 1));
  assetManager.addAssetSource(new ClasspathSource("unittest",url,TerasologyConstants.ASSETS_SUBDIRECTORY,TerasologyConstants.OVERRIDES_SUBDIRECTORY));
  NetworkSystem networkSystem=mock(NetworkSystem.class);
  when(networkSystem.getMode()).thenReturn(NetworkMode.NONE);
  EntityManager em=new EntitySystemBuilder().build(moduleManager,networkSystem,new ReflectionReflectFactory());
  prefabManager=new PojoPrefabManager();
}
