{
  HealthComponent health=targetHealthComponent;
  if (health == null) {
    health=entity.getComponent(HealthComponent.class);
  }
  int damagedAmount=health.currentHealth - Math.max(health.currentHealth - damageAmount,0);
  health.currentHealth-=damagedAmount;
  health.nextRegenTick=time.getGameTimeInMs() + TeraMath.floorToInt(health.waitBeforeRegen * 1000);
  entity.saveComponent(health);
  entity.send(new OnDamagedEvent(damageAmount,damagedAmount,damageType,instigator));
  if (health.currentHealth == 0) {
    entity.send(new DestroyEvent(instigator,directCause,damageType));
  }
}
