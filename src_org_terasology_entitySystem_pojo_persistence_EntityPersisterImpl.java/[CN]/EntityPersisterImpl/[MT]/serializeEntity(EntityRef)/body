{
  EntityInfoComponent entityInfo=entityRef.getComponent(EntityInfoComponent.class);
  if (entityInfo != null) {
    if (entityInfo.parentPrefab != null && prefabManager.exists(entityInfo.parentPrefab)) {
      return serializeEntityDelta(entityRef,prefabManager.getPrefab(entityInfo.parentPrefab));
    }
  }
  EntityData.Entity.Builder entity=EntityData.Entity.newBuilder();
  entity.setId(entityRef.getId());
  for (  Component component : entityRef.iterateComponents()) {
    if (component.getClass().equals(EntityInfoComponent.class))     continue;
    EntityData.Component componentData=serializeComponent(component);
    if (componentData != null) {
      entity.addComponent(componentData);
    }
  }
  return entity.build();
}
