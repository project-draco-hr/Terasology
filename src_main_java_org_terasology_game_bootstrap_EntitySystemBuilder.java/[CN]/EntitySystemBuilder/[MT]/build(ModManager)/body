{
  ComponentLibrary library=new ComponentLibraryImpl();
  registerTypeHandlers(library);
  CoreRegistry.put(ComponentLibrary.class,library);
  PrefabManager prefabManager=new PojoPrefabManager(library);
  CoreRegistry.put(PrefabManager.class,prefabManager);
  PersistableEntityManager entityManager=new PojoEntityManager(library,prefabManager);
  entityManager.setEventSystem(new PojoEventSystem());
  CoreRegistry.put(EntityManager.class,entityManager);
  CoreRegistry.put(EventSystem.class,entityManager.getEventSystem());
  registerComponents(library,modManager);
  registerEvents(entityManager.getEventSystem(),modManager);
  return entityManager;
}
