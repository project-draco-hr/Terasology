{
  Map<BlockPart,AssetUri> tileUris=prepareTiles(blockDef,blockDefUri);
  Map<BlockPart,DefaultColorSource> colorSourceMap=prepareColorSources(blockDef);
  Map<BlockPart,Vector4f> colorOffsetsMap=prepareColorOffsets(blockDef);
  BlockShape shape=getShape(blockDef);
  Block block=createRawBlock(blockDef,blockDefUri.getAssetName());
  block.setDirection(rotation.rotate(Side.FRONT));
  block.setPrimaryAppearance(createAppearance(shape,tileUris,rotation));
  setBlockFullSides(block,shape,rotation);
  block.setCollision(shape.getCollisionOffset(rotation),shape.getCollisionShape(rotation));
  for (  BlockPart part : BlockPart.values()) {
    block.setColorSource(part,colorSourceMap.get(part));
    block.setColorOffset(part,colorOffsetsMap.get(part));
  }
  return block;
}
