{
  final UIText worldName=find("worldName",UIText.class);
  if (worldName != null) {
    int gameNum=1;
    for (    GameInfo info : GameProvider.getSavedGames()) {
      if (info.getManifest().getTitle().startsWith(DEFAULT_GAME_NAME_PREFIX)) {
        String remainder=info.getManifest().getTitle().substring(DEFAULT_GAME_NAME_PREFIX.length());
        try {
          gameNum=Math.max(gameNum,Integer.parseInt(remainder) + 1);
        }
 catch (        NumberFormatException e) {
          logger.trace("Could not parse {} as integer (not an error)",remainder,e);
        }
      }
    }
    worldName.setText(DEFAULT_GAME_NAME_PREFIX + gameNum);
  }
  final UIText seed=find("seed",UIText.class);
  if (seed != null) {
    seed.setText(new FastRandom().nextString(32));
  }
  final UIDropdown<WorldGeneratorInfo> worldGenerator=find("worldGenerator",UIDropdown.class);
  if (worldGenerator != null) {
    worldGenerator.bindOptions(new ReadOnlyBinding<List<WorldGeneratorInfo>>(){
      @Override public List<WorldGeneratorInfo> get(){
        List<WorldGeneratorInfo> result=Lists.newArrayList();
        for (        WorldGeneratorInfo option : worldGeneratorManager.getWorldGenerators()) {
          if (config.getDefaultModSelection().hasModule(option.getUri().getModuleName())) {
            result.add(option);
          }
        }
        return result;
      }
    }
);
    worldGenerator.bindSelection(new Binding<WorldGeneratorInfo>(){
      @Override public WorldGeneratorInfo get(){
        WorldGeneratorInfo info=worldGeneratorManager.getWorldGeneratorInfo(config.getWorldGeneration().getDefaultGenerator());
        if (info == null || !config.getDefaultModSelection().hasModule(info.getUri().getModuleName())) {
          for (          WorldGeneratorInfo worldGenInfo : worldGeneratorManager.getWorldGenerators()) {
            if (config.getDefaultModSelection().hasModule(worldGenInfo.getUri().getModuleName())) {
              set(worldGenInfo);
              return worldGenInfo;
            }
          }
        }
        return info;
      }
      @Override public void set(      WorldGeneratorInfo value){
        if (value != null) {
          config.getWorldGeneration().setDefaultGenerator(value.getUri());
        }
      }
    }
);
    worldGenerator.setOptionRenderer(new StringTextRenderer<WorldGeneratorInfo>(){
      @Override public String getString(      WorldGeneratorInfo value){
        if (value != null) {
          return value.getDisplayName();
        }
        return "";
      }
    }
);
  }
  WidgetUtil.trySubscribe(this,"close",new ActivateEventListener(){
    @Override public void onActivated(    UIWidget button){
      getManager().popScreen();
    }
  }
);
  WidgetUtil.trySubscribe(this,"play",new ActivateEventListener(){
    @Override public void onActivated(    UIWidget button){
      if (worldGenerator.getSelection() == null) {
        ErrorMessagePopup errorMessagePopup=getManager().pushScreen("engine:errorMessagePopup",ErrorMessagePopup.class);
        if (errorMessagePopup != null) {
          errorMessagePopup.setError("No World Generator Selected","Select a world generator (you may need to activate a mod with a generator first).");
        }
      }
 else {
        GameManifest gameManifest=new GameManifest();
        gameManifest.setTitle(worldName.getText());
        gameManifest.setSeed(seed.getText());
        for (        String moduleName : config.getDefaultModSelection().listModules()) {
          Module module=moduleManager.getLatestModuleVersion(moduleName);
          if (module != null) {
            gameManifest.addModule(module.getId(),module.getVersion());
          }
        }
        WorldInfo worldInfo=new WorldInfo(TerasologyConstants.MAIN_WORLD,gameManifest.getSeed(),(long)(WorldTime.DAY_LENGTH * 0.025f),worldGenerator.getSelection().getUri());
        gameManifest.addWorld(worldInfo);
        gameEngine.changeState(new StateLoading(gameManifest,(loadingAsServer) ? NetworkMode.DEDICATED_SERVER : NetworkMode.NONE));
      }
    }
  }
);
  UIButton previewSeed=find("previewSeed",UIButton.class);
  previewSeed.bindVisible(new ReadOnlyBinding<Boolean>(){
    @Override public Boolean get(){
      return worldGenerator != null && worldGenerator.getSelection() != null;
    }
  }
);
  WidgetUtil.trySubscribe(this,"previewSeed",new ActivateEventListener(){
    @Override public void onActivated(    UIWidget button){
      PreviewWorldScreen screen=getManager().pushScreen("engine:previewWorldScreen",PreviewWorldScreen.class);
      if (screen != null) {
        screen.bindSeed(BindHelper.bindBeanProperty("text",seed,String.class));
      }
    }
  }
);
  WidgetUtil.trySubscribe(this,"config",new ActivateEventListener(){
    @Override public void onActivated(    UIWidget button){
      getManager().pushScreen("engine:configWorldGen");
    }
  }
);
  WidgetUtil.trySubscribe(this,"mods",new ActivateEventListener(){
    @Override public void onActivated(    UIWidget button){
      getManager().pushScreen("engine:selectModsScreen");
    }
  }
);
}
