{
  ModManager modManager=new ModManager();
  for (  Mod mod : modManager.getMods()) {
    mod.setEnabled(true);
  }
  modManager.saveModSelectionToConfig();
  CoreRegistry.put(ModManager.class,modManager);
  AssetManager.getInstance().clear();
  BlockManager.getInstance().load(worldInfo.getBlockIdMap());
  cacheTextures();
  cacheBlockMesh();
  entityManager=new EntitySystemBuilder().build();
  eventSystem=CoreRegistry.get(EventSystem.class);
  componentSystemManager=new ComponentSystemManager();
  CoreRegistry.put(ComponentSystemManager.class,componentSystemManager);
  localPlayerSys=new LocalPlayerSystem();
  componentSystemManager.register(localPlayerSys,"engine:LocalPlayerSystem");
  cameraTargetSystem=new CameraTargetSystem();
  CoreRegistry.put(CameraTargetSystem.class,cameraTargetSystem);
  componentSystemManager.register(cameraTargetSystem,"engine:CameraTargetSystem");
  inputSystem=new InputSystem();
  CoreRegistry.put(InputSystem.class,inputSystem);
  componentSystemManager.register(inputSystem,"engine:InputSystem");
  componentSystemManager.loadEngineSystems();
  componentSystemManager.loadSystems("miniions","org.terasology.mods.miniions");
  CoreRegistry.put(WorldPersister.class,new WorldPersister(entityManager));
  loadPrefabs();
  CoreRegistry.put(CommandManager.class,new CommandManager());
}
