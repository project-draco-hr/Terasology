{
  long timeStart=System.currentTimeMillis();
  final FastList<Chunk> dirtyChunks=new FastList<Chunk>(_parent.getVisibleChunks());
  for (int i=dirtyChunks.size() - 1; i >= 0; i--) {
    Chunk c=dirtyChunks.get(i);
    if (c == null) {
      dirtyChunks.remove(i);
      continue;
    }
    if (!(c.isDirty() || c.isFresh() || c.isLightDirty())) {
      dirtyChunks.remove(i);
    }
  }
  Collections.sort(dirtyChunks);
  if (dirtyChunks.isEmpty()) {
    return;
  }
  final Chunk chunkToProcess=dirtyChunks.removeFirst();
  if (!_currentlyProcessedChunks.contains(chunkToProcess)) {
    _currentlyProcessedChunks.add(chunkToProcess);
    Thread t=new Thread(){
      @Override public void run(){
synchronized (_currentlyProcessedChunks) {
          if (_currentlyProcessedChunks.size() > Runtime.getRuntime().availableProcessors() / 2) {
            try {
              _currentlyProcessedChunks.wait();
            }
 catch (            InterruptedException e) {
            }
          }
        }
        processChunkUpdate(chunkToProcess);
synchronized (_currentlyProcessedChunks) {
          _currentlyProcessedChunks.remove(chunkToProcess);
          _currentlyProcessedChunks.notify();
        }
      }
    }
;
    t.start();
  }
  _chunkUpdateAmount=dirtyChunks.size();
  _meanUpdateDuration+=System.currentTimeMillis() - timeStart;
  _meanUpdateDuration/=2;
}
