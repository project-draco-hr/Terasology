{
  if (!uri.isValid()) {
    return null;
  }
  Asset<?> asset=assetCache.get(uri);
  if (asset != null) {
    return asset;
  }
  AssetFactory<D,Asset<D>> factory=(AssetFactory<D,Asset<D>>)factories.get(uri.getAssetType());
  if (factory == null) {
    logger.error("No asset factory set for assets of type {}",uri.getAssetType());
    return null;
  }
  for (  AssetResolver<?,?> resolver : resolvers.get(uri.getAssetType())) {
    AssetResolver<Asset<D>,D> typedResolver=(AssetResolver<Asset<D>,D>)resolver;
    Asset<D> result=typedResolver.resolve(uri,factory);
    if (result != null) {
      assetCache.put(uri,result);
      return result;
    }
  }
  try (ModuleContext.ContextSpan ignored=ModuleContext.setContext(environment.get(uri.getModuleName()))){
    AssetData data=loadAssetData(uri,logErrors);
    if (data != null) {
      asset=factory.buildAsset(uri,(D)data);
      if (asset != null) {
        logger.debug("Loaded {}",uri);
        assetCache.put(uri,asset);
      }
    }
  }
 catch (  Exception e) {
    logger.error("Error loading asset: {}",uri,e);
  }
  return asset;
}
