{
  while (Keyboard.next()) {
    KeyEvent e;
    if (Keyboard.getEventKeyState()) {
      if (Keyboard.isRepeatEvent()) {
        e=KEY_REPEAT_EVENT;
      }
 else {
        e=KEY_DOWN_EVENT;
      }
    }
 else {
      e=KEY_UP_EVENT;
    }
    e.reset();
    e.key=Keyboard.getEventKey();
    e.target=target;
    eventSystem.send(localPlayerRef,e);
    if (!e.isConsumed()) {
      keybinds.get(e.key).process(e.getState());
    }
  }
}
