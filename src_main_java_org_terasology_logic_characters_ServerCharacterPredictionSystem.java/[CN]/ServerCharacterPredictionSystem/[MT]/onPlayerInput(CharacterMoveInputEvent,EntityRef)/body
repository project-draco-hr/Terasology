{
  CircularBuffer<CharacterStateEvent> stateBuffer=characterStates.get(entity);
  CharacterStateEvent lastState=stateBuffer.getLast();
  CharacterStateEvent newState=stepState(input,lastState,entity);
  stateBuffer.add(newState);
  CharacterStateEvent.setToState(entity,newState);
}
