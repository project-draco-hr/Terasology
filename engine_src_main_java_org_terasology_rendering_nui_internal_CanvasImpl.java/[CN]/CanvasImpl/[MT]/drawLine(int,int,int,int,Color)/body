{
  Rect2i region=Rect2i.createFromMinAndMax(Math.min(startX,endX),Math.min(startY,endY),Math.max(startX,endX),Math.max(startY,endY));
  Rect2i absoluteRegion=relativeToAbsolute(region);
  Rect2i finalRegion=state.cropRegion.intersect(absoluteRegion);
  if (!finalRegion.isEmpty()) {
    int sx=finalRegion.minX();
    int sy=finalRegion.minY();
    int ex=finalRegion.maxX();
    int ey=finalRegion.maxY();
    if (state.drawOnTop) {
      drawOnTopOperations.add(new DrawLineOperation(sx,sy,ex,ey,color));
    }
 else {
      renderer.drawLine(sx,sy,ex,ey,color);
    }
  }
}
