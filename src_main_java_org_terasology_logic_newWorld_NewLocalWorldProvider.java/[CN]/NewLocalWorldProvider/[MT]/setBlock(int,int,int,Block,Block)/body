{
  if (type.isTranslucent() != oldType.isTranslucent() || type.getLuminance() != oldType.getLuminance()) {
    Vector3i blockPos=new Vector3i(x,y,z);
    WorldView worldView=WorldView.createSubview(blockPos,NewChunk.MAX_LIGHT + 1,chunkProvider);
    if (worldView != null) {
      if (!worldView.setBlock(x,y,z,type,oldType)) {
        return false;
      }
      Region3i affected=new LightPropagator(worldView).update(x,y,z,type,oldType);
      if (affected.isEmpty()) {
        worldView.setDirtyAround(blockPos);
      }
 else {
        worldView.setDirtyAround(affected);
      }
    }
  }
 else {
    Vector3i chunkPos=TeraMath.calcChunkPos(x,y,z);
    NewChunk chunk=chunkProvider.getChunk(chunkPos);
    if (chunk != null) {
      Vector3i blockPos=TeraMath.calcBlockPos(x,y,z,chunkPos);
      return chunk.setBlock(blockPos.x,blockPos.y,blockPos.z,type,oldType);
    }
  }
  return false;
}
