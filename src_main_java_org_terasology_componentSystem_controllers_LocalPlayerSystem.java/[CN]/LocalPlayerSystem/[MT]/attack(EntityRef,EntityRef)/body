{
  RayBlockIntersection.Intersection selectedBlock=calcSelectedBlock();
  ItemComponent item=withItem.getComponent(ItemComponent.class);
  if (selectedBlock != null) {
    BlockPosition blockPos=selectedBlock.getBlockPosition();
    Block block=worldProvider.getBlock(blockPos.x,blockPos.y,blockPos.z);
    int damage=1;
    if (item != null) {
      damage=item.baseDamage;
      if (item.getPerBlockDamageBonus().containsKey(block.getBlockFamily().getTitle())) {
        damage+=item.getPerBlockDamageBonus().get(block.getBlockFamily().getTitle());
      }
    }
    EntityRef blockEntity=blockEntityRegistry.getOrCreateEntityAt(blockPos);
    blockEntity.send(new DamageEvent(damage,player));
  }
}
