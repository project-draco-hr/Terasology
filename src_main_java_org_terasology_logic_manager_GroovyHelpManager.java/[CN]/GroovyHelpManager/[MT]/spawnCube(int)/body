{
  EntityManager entMan=CoreRegistry.get(EntityManager.class);
  if (entMan != null) {
    MiniionFactory factory=new MiniionFactory();
    factory.setEntityManager(entMan);
    LocalPlayer localPlayer=CoreRegistry.get(LocalPlayer.class);
    LocalPlayerComponent localPlayerComponent=localPlayer.getEntity().getComponent(LocalPlayerComponent.class);
    MinionBarComponent inventory=localPlayer.getEntity().getComponent(MinionBarComponent.class);
    int freeSlot=inventory.MinionSlots.indexOf(EntityRef.NULL);
    if (freeSlot != -1) {
      RayBlockIntersection.Intersection blockIntersection=calcSelectedBlock();
      if (blockIntersection != null) {
        Vector3i centerPos=blockIntersection.getBlockPosition();
        factory.setRandom(new FastRandom());
        inventory.MinionSlots.set(slot,factory.generateMiniion(new Vector3f(centerPos.x,centerPos.y + 1,centerPos.z),localPlayerComponent.selectedMinion));
        localPlayer.getEntity().saveComponent(inventory);
      }
    }
  }
}
