{
  for (  Field field : ReflectionUtils.getAllFields(system.getClass(),ReflectionUtils.withAnnotation(In.class))) {
    Object value=CoreRegistry.get(field.getType());
    if (value != null) {
      try {
        field.setAccessible(true);
        field.set(system,value);
      }
 catch (      IllegalAccessException e) {
        logger.error("Failed to inject value {} into field {} of system {}",value,field,system,e);
      }
    }
  }
  if (console != null) {
    console.registerCommandProvider(system);
  }
  try {
    system.initialise();
  }
 catch (  Throwable e) {
    logger.error("Failed to initialise system {}",system,e);
  }
}
