{
  super.setup();
  ModuleManager moduleManager=ModuleManagerFactory.create();
  context.put(ModuleManager.class,moduleManager);
  EngineTime mockTime=mock(EngineTime.class);
  networkSystem=new NetworkSystemImpl(mockTime,context);
  entityManager=new EntitySystemBuilder().build(context.get(ModuleManager.class).getEnvironment(),networkSystem,new ReflectionReflectFactory());
  context.put(ComponentSystemManager.class,new ComponentSystemManager());
  entityManager.clear();
  client=mock(NetClient.class);
  NetworkComponent clientNetComp=new NetworkComponent();
  clientNetComp.replicateMode=NetworkComponent.ReplicateMode.OWNER;
  clientEntity=entityManager.create(clientNetComp);
  when(client.getEntity()).thenReturn(clientEntity);
  when(client.getId()).thenReturn("dummyID");
  networkSystem.mockHost();
  networkSystem.connectToEntitySystem(entityManager,context.get(EntitySystemLibrary.class),mock(BlockEntityRegistry.class));
  networkSystem.registerNetworkEntity(clientEntity);
}
