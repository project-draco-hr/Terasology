{
  Particle p=new Particle();
  p.lifeRemaining=random.randomPosFloat() * (particleEffect.maxLifespan - particleEffect.minLifespan) + particleEffect.minLifespan;
  p.velocity.set(particleEffect.initialVelocityRange.x * random.randomFloat(),particleEffect.initialVelocityRange.y * random.randomFloat(),particleEffect.initialVelocityRange.z * random.randomFloat());
  p.size=random.randomPosFloat() * (particleEffect.maxSize - particleEffect.minSize) + particleEffect.minSize;
  p.position.set(particleEffect.spawnRange.x * random.randomFloat(),particleEffect.spawnRange.y * random.randomFloat(),particleEffect.spawnRange.z * random.randomFloat());
  p.color=particleEffect.color;
  if (particleEffect.blockType != null) {
    final float tileSize=worldAtlas.getRelativeTileSize();
    p.texSize.set(tileSize,tileSize);
    Block b=particleEffect.blockType.getArchetypeBlock();
    p.texOffset.set(b.getPrimaryAppearance().getTextureAtlasPos(BlockPart.FRONT));
    if (particleEffect.randBlockTexDisplacement) {
      final float relTileSize=worldAtlas.getRelativeTileSize();
      Vector2f particleTexSize=new Vector2f(relTileSize * particleEffect.randBlockTexDisplacementScale.y,relTileSize * particleEffect.randBlockTexDisplacementScale.y);
      p.texSize.x*=particleEffect.randBlockTexDisplacementScale.x;
      p.texSize.y*=particleEffect.randBlockTexDisplacementScale.y;
      p.texOffset.set(p.texOffset.x + random.randomPosFloat() * (tileSize - particleTexSize.x),p.texOffset.y + random.randomPosFloat() * (tileSize - particleTexSize.y));
    }
  }
  particleEffect.particles.add(p);
  particleEffect.spawnCount--;
}
