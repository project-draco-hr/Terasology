{
  PerformanceMonitor.startActivity("Render Light Geometry");
  graphicState.preRenderSetupLightGeometry();
  EntityManager entityManager=CoreRegistry.get(EntityManager.class);
  for (  EntityRef entity : entityManager.getEntitiesWith(LightComponent.class,LocationComponent.class)) {
    LocationComponent locationComponent=entity.getComponent(LocationComponent.class);
    LightComponent lightComponent=entity.getComponent(LightComponent.class);
    final Vector3f worldPosition=locationComponent.getWorldPosition();
    renderLightComponent(lightComponent,worldPosition,lightGeometryShader,false);
  }
  graphicState.postRenderCleanupLightGeometry();
  graphicState.preRenderSetupDirectionalLights();
  Vector3f sunlightWorldPosition=new Vector3f(backdropProvider.getSunDirection(true));
  sunlightWorldPosition.scale(50000f);
  sunlightWorldPosition.add(playerCamera.getPosition());
  renderLightComponent(mainDirectionalLight,sunlightWorldPosition,lightGeometryShader,false);
  graphicState.postRenderCleanupDirectionalLights();
  postProcessor.applyLightBufferPass("sceneOpaque");
  PerformanceMonitor.endActivity();
}
