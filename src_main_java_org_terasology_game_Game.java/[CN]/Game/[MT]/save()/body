{
  StorageManager storageManager=CoreRegistry.get(StorageManager.class);
  if (storageManager != null) {
    Time time=CoreRegistry.get(Time.class);
    BlockManager blockManager=CoreRegistry.get(BlockManager.class);
    WorldProvider worldProvider=CoreRegistry.get(WorldProvider.class);
    ModConfig modConfig=new ModConfig();
    for (    Module module : CoreRegistry.get(ModuleManager.class).getActiveModules()) {
      modConfig.addMod(module.getModuleInfo().getId());
    }
    GameManifest gameManifest=new GameManifest(name,seed,time.getGameTimeInMs(),modConfig);
    List<String> registeredBlockFamilies=Lists.newArrayList();
    for (    BlockFamily family : blockManager.listRegisteredBlockFamilies()) {
      registeredBlockFamilies.add(family.getURI().toString());
    }
    gameManifest.setRegisteredBlockFamilies(registeredBlockFamilies);
    gameManifest.setBlockIdMap(blockManager.getBlockIdMap());
    gameManifest.addWorldInfo(worldProvider.getWorldInfo());
    try {
      GameManifest.save(PathManager.getInstance().getCurrentSavePath().resolve(GameManifest.DEFAULT_FILE_NAME),gameManifest);
    }
 catch (    IOException e) {
      logger.error("Failed to save world manifest",e);
    }
    try {
      storageManager.flush();
    }
 catch (    IOException e) {
      logger.error("Failed to save game",e);
    }
    storageManager.shutdown();
  }
}
