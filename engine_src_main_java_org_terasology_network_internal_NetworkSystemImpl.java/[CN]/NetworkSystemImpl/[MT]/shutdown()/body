{
  if (mode != NetworkMode.NONE) {
    allChannels.close().awaitUninterruptibly();
    factory.releaseExternalResources();
  }
  processPendingDisconnects();
  for (  Client client : clientList) {
    processRemovedClient(client);
  }
  server=null;
  nextNetId=1;
  netIdToEntityId.clear();
  if (mode != NetworkMode.CLIENT) {
    if (this.entityManager != null) {
      for (      EntityRef entity : entityManager.getEntitiesWith(NetworkComponent.class)) {
        NetworkComponent netComp=entity.getComponent(NetworkComponent.class);
        netComp.setNetworkId(0);
        entity.saveComponent(netComp);
      }
      this.entityManager.unsubscribe(this);
    }
  }
  mode=NetworkMode.NONE;
  entityManager=null;
  entitySystemLibrary=null;
  eventSerializer=null;
  entitySerializer=null;
  clientList.clear();
  netClientList.clear();
  blockManager=null;
  ownerLookup.clear();
  ownedLookup.clear();
  ownershipHelper=null;
  logger.info("Network shutdown");
}
