{
  while (worldRenderer.getWorldProvider().getBlock(spawnPos) == BlockManager.getAir() && spawnPos.y > 0) {
    spawnPos.y--;
  }
  ClientComponent client=clientEntity.getComponent(ClientComponent.class);
  if (client != null) {
    PlayerFactory playerFactory=new PlayerFactory(entityManager,inventoryManager);
    EntityRef playerCharacter=playerFactory.newInstance(new Vector3f(spawnPos.x,spawnPos.y + 1.5f,spawnPos.z),clientEntity);
    Location.attachChild(playerCharacter,clientEntity,new Vector3f(),new Quat4f(0,0,0,1));
    Client clientListener=networkSystem.getOwner(clientEntity);
    int distance=clientListener.getViewDistance();
    if (!clientListener.isLocal()) {
      distance+=ChunkConstants.REMOTE_GENERATION_DISTANCE;
    }
    worldRenderer.getChunkProvider().updateRelevanceEntity(clientEntity,distance);
    client.character=playerCharacter;
    clientEntity.saveComponent(client);
    playerCharacter.send(new OnPlayerSpawnedEvent());
  }
}
