{
  if (config.getRendering().getDebug().isWireframe()) {
    glPolygonMode(GL_FRONT_AND_BACK,GL_LINE);
  }
  DefaultRenderingProcess.getInstance().clear();
  DefaultRenderingProcess.getInstance().beginRenderSceneOpaque();
  camera.lookThroughNormalized();
  PerformanceMonitor.startActivity("Render Sky");
  DefaultRenderingProcess.getInstance().beginRenderSceneSky();
  skysphere.render(camera);
  DefaultRenderingProcess.getInstance().endRenderSceneSky();
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render World");
  camera.lookThrough();
  PerformanceMonitor.startActivity("Render Objects (Opaque)");
  for (  RenderSystem renderer : systemManager.iterateRenderSubscribers()) {
    renderer.renderOpaque();
  }
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render Chunks (Opaque)");
  while (renderQueueChunksOpaque.size() > 0) {
    renderChunk(renderQueueChunksOpaque.poll(),ChunkMesh.RenderPhase.OPAQUE,camera,ChunkRenderMode.DEFAULT);
  }
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render Chunks (Alpha Reject)");
  while (renderQueueChunksAlphaReject.size() > 0) {
    renderChunk(renderQueueChunksAlphaReject.poll(),ChunkMesh.RenderPhase.ALPHA_REJECT,camera,ChunkRenderMode.DEFAULT);
  }
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render Overlays");
  for (  RenderSystem renderer : systemManager.iterateRenderSubscribers()) {
    renderer.renderOverlay();
  }
  PerformanceMonitor.endActivity();
  if (activeCamera != null && !config.getRendering().getDebug().isFirstPersonElementsHidden()) {
    PerformanceMonitor.startActivity("Render First Person");
    glPushMatrix();
    glLoadIdentity();
    activeCamera.updateMatrices(90f);
    activeCamera.loadProjectionMatrix();
    glDepthFunc(GL11.GL_ALWAYS);
    for (    RenderSystem renderer : systemManager.iterateRenderSubscribers()) {
      renderer.renderFirstPerson();
    }
    glDepthFunc(GL_LEQUAL);
    activeCamera.updateMatrices();
    activeCamera.loadProjectionMatrix();
    glPopMatrix();
    PerformanceMonitor.endActivity();
  }
  DefaultRenderingProcess.getInstance().endRenderSceneOpaque();
  PerformanceMonitor.startActivity("Render Light Geometry");
  DefaultRenderingProcess.getInstance().beginRenderLightGeometryStencilPass();
  Material program=Assets.getMaterial("engine:simple");
  program.enable();
  program.setCamera(camera);
  EntityManager entityManager=CoreRegistry.get(EntityManager.class);
  for (  EntityRef entity : entityManager.getEntitiesWith(LightComponent.class,LocationComponent.class)) {
    LocationComponent locationComponent=entity.getComponent(LocationComponent.class);
    LightComponent lightComponent=entity.getComponent(LightComponent.class);
    final Vector3f worldPosition=locationComponent.getWorldPosition();
    renderLightComponent(lightComponent,worldPosition,program,camera,true);
  }
  DefaultRenderingProcess.getInstance().endRenderLightGeometryStencilPass();
  DefaultRenderingProcess.getInstance().beginRenderLightGeometry();
  program=Assets.getMaterial("engine:lightGeometryPass");
  for (  EntityRef entity : entityManager.getEntitiesWith(LightComponent.class,LocationComponent.class)) {
    LocationComponent locationComponent=entity.getComponent(LocationComponent.class);
    LightComponent lightComponent=entity.getComponent(LightComponent.class);
    final Vector3f worldPosition=locationComponent.getWorldPosition();
    renderLightComponent(lightComponent,worldPosition,program,camera,false);
  }
  DefaultRenderingProcess.getInstance().endRenderLightGeometry();
  DefaultRenderingProcess.getInstance().beginRenderDirectionalLights();
  Vector3f sunlightWorldPosition=new Vector3f(skysphere.getSunDirection(true));
  sunlightWorldPosition.scale(50000f);
  sunlightWorldPosition.add(activeCamera.getPosition());
  renderLightComponent(mainDirectionalLight,sunlightWorldPosition,program,camera,false);
  DefaultRenderingProcess.getInstance().endRenderDirectionalLights();
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render Chunks (Alpha blend)");
  DefaultRenderingProcess.getInstance().beginRenderSceneTransparent();
  boolean isHeadUnderWater=isHeadUnderWater();
  if (isHeadUnderWater) {
    glDisable(GL11.GL_CULL_FACE);
  }
  while (renderQueueChunksAlphaBlend.size() > 0) {
    renderChunk(renderQueueChunksAlphaBlend.poll(),ChunkMesh.RenderPhase.REFRACTIVE,camera,ChunkRenderMode.DEFAULT);
  }
  PerformanceMonitor.endActivity();
  if (isHeadUnderWater) {
    glEnable(GL11.GL_CULL_FACE);
  }
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Render Objects (Transparent)");
  glEnable(GL_BLEND);
  glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);
  glDepthMask(false);
  for (  RenderSystem renderer : systemManager.iterateRenderSubscribers()) {
    renderer.renderAlphaBlend();
  }
  glDisable(GL_BLEND);
  glDepthMask(true);
  PerformanceMonitor.endActivity();
  DefaultRenderingProcess.getInstance().endRenderSceneTransparent();
  if (config.getRendering().getDebug().isWireframe()) {
    glPolygonMode(GL_FRONT_AND_BACK,GL_FILL);
  }
}
