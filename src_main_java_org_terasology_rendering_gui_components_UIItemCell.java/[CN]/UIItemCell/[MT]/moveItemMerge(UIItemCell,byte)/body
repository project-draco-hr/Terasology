{
  EntityRef item=getFromTransferSlot();
  ItemComponent sourceItem=item.getComponent(ItemComponent.class);
  InventoryComponent targetInventory=targetCell.getOwnerEntity().getComponent(InventoryComponent.class);
  ItemComponent targetItem=targetInventory.itemSlots.get(targetCell.slot).getComponent(ItemComponent.class);
  if (targetItem.stackId.equals(sourceItem.stackId) && !targetItem.stackId.isEmpty() && !sourceItem.stackId.isEmpty()) {
    if (amount == 0) {
      amount=sourceItem.stackCount;
    }
    int spaceLeft=InventorySystem.MAX_STACK - targetItem.stackCount;
    amount=(byte)Math.min(amount,sourceItem.stackCount);
    amount=(byte)Math.min(amount,spaceLeft);
    if (spaceLeft > 0) {
      targetItem.stackCount+=amount;
      sourceItem.stackCount-=amount;
      if (sourceItem.stackCount == 0) {
        sendToTransferSlot(null,(byte)0);
      }
      return true;
    }
  }
  return false;
}
