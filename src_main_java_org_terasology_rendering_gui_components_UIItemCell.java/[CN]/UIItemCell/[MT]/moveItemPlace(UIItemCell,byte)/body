{
  EntityRef item=getFromTransferSlot();
  ItemComponent sourceItem=item.getComponent(ItemComponent.class);
  if (!targetCell.ownerInventory.itemSlots.get(targetCell.slot).exists()) {
    if (amount == 0) {
      sourceItem.container=targetCell.ownerEntity;
      targetCell.ownerInventory.itemSlots.set(targetCell.slot,item);
      sendToTransferSlot(null,(byte)0);
      return true;
    }
 else {
      EntityManager entityManager=CoreRegistry.get(EntityManager.class);
      EntityRef copy=entityManager.copy(item);
      ItemComponent copyItem=copy.getComponent(ItemComponent.class);
      amount=(byte)Math.min(amount,sourceItem.stackCount);
      if (sourceItem.stackCount > amount) {
        sourceItem.stackCount-=amount;
        copyItem.stackCount=amount;
        copyItem.container=targetCell.ownerEntity;
        targetCell.ownerInventory.itemSlots.set(targetCell.slot,copy);
        return true;
      }
 else {
        targetCell.ownerInventory.itemSlots.set(targetCell.slot,item);
        sendToTransferSlot(null,(byte)0);
        return true;
      }
    }
  }
  return false;
}
