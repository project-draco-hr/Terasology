{
  entityManager=new EntitySystemBuilder().build(CoreRegistry.get(ModuleManager.class).getEnvironment(),CoreRegistry.get(NetworkSystem.class),CoreRegistry.get(ReflectFactory.class),CoreRegistry.get(CopyStrategyLibrary.class));
  eventSystem=CoreRegistry.get(EventSystem.class);
  CoreRegistry.put(Console.class,new ConsoleImpl());
  NUIManager nuiManager=CoreRegistry.get(NUIManager.class);
  ((NUIManagerInternal)nuiManager).refreshWidgetsLibrary();
  componentSystemManager=new ComponentSystemManager();
  CoreRegistry.put(ComponentSystemManager.class,componentSystemManager);
  componentSystemManager.register(new ConsoleSystem(),"engine:ConsoleSystem");
  CoreCommands.initialiseCommands();
  EntityRef localPlayerEntity=entityManager.create(new ClientComponent());
  LocalPlayer localPlayer=CoreRegistry.put(LocalPlayer.class,new LocalPlayer());
  localPlayer.setClientEntity(localPlayerEntity);
  componentSystemManager.initialise();
}
