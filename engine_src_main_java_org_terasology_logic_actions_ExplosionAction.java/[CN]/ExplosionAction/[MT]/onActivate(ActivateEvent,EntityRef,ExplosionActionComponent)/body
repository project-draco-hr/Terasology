{
  Vector3f origin=null;
switch (explosionComp.relativeTo) {
case Self:
    LocationComponent loc=entity.getComponent(LocationComponent.class);
  if (loc != null) {
    origin=loc.getWorldPosition();
  }
break;
case Instigator:
origin=event.getInstigatorLocation();
break;
default :
origin=event.getTargetLocation();
break;
}
if (origin == null) {
return;
}
EntityBuilder builder=entityManager.newBuilder("engine:smokeExplosion");
builder.getComponent(LocationComponent.class).setWorldPosition(origin);
builder.build();
Vector3i blockPos=new Vector3i();
for (int i=0; i < 64; i++) {
Vector3f direction=random.nextVector3f(1.0f);
Vector3f impulse=new Vector3f(direction);
impulse.scale(150);
for (int j=0; j < 4; j++) {
Vector3f target=new Vector3f(origin);
target.x+=direction.x * j;
target.y+=direction.y * j;
target.z+=direction.z * j;
blockPos.set((int)target.x,(int)target.y,(int)target.z);
Block currentBlock=worldProvider.getBlock(blockPos);
if (currentBlock.isDestructible()) {
blockEntityRegistry.getEntityAt(blockPos).send(new DoDamageEvent(1000,EngineDamageTypes.EXPLOSIVE.get(),EntityRef.NULL));
}
}
}
}
