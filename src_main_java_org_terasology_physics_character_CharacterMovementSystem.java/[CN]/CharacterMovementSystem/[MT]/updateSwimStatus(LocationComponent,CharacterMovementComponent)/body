{
  Vector3f worldPos=location.getWorldPosition();
  List<BlockPosition> blockPositions=WorldUtil.gatherAdjacentBlockPositions(worldPos);
  boolean topUnderwater=false;
  boolean bottomUnderwater=false;
  Vector3f top=new Vector3f(worldPos);
  Vector3f bottom=new Vector3f(worldPos);
  top.y+=0.25f * movementComp.height;
  bottom.y-=0.25f * movementComp.height;
  for (int i=0; i < blockPositions.size(); i++) {
    BlockPosition p=blockPositions.get(i);
    Block block=worldProvider.getBlock(p);
    if (block.isLiquid()) {
      AABB blockAABB=block.getBounds(p);
      if (blockAABB.contains(top)) {
        topUnderwater=true;
      }
      if (blockAABB.contains(bottom)) {
        bottomUnderwater=true;
      }
    }
  }
  boolean newSwimming=topUnderwater && bottomUnderwater;
  if (!newSwimming && movementComp.isSwimming && movementComp.getVelocity().y > 0) {
    float len=movementComp.getVelocity().length();
    movementComp.getVelocity().scale((len + 8) / len);
  }
  movementComp.isSwimming=newSwimming;
}
