{
  int chunkPosX=calcChunkPosX(x) % Configuration.getSettingNumeric("V_DIST_X").intValue();
  int chunkPosZ=calcChunkPosZ(z) % Configuration.getSettingNumeric("V_DIST_Z").intValue();
  int blockPosX=calcBlockPosX(x,chunkPosX);
  int blockPosZ=calcBlockPosZ(z,chunkPosZ);
  Chunk c=loadOrCreateChunk(calcChunkPosX(x),calcChunkPosZ(z));
  if (overwrite || c.getBlock(blockPosX,y,blockPosZ) == 0) {
    c.setBlock(blockPosX,y,blockPosZ,type);
    if (update) {
      byte oldValue=getLight(x,y,z);
      c.calcSunlightAtLocalPos(blockPosX,blockPosZ,true);
      c.refreshLightAtLocalPos(blockPosX,y,blockPosZ);
      byte newValue=getLight(x,y,z);
      if (newValue > oldValue) {
        c.spreadLight(blockPosX,y,blockPosZ,newValue);
      }
 else       if (newValue < oldValue) {
      }
      queueChunkForUpdate(c);
    }
  }
}
