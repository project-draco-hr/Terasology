{
  EntityRef entity=create();
  if (prefab != null) {
    final EntityBeingGeneratedFromPrefab generationEvent=new EntityBeingGeneratedFromPrefab(prefab,components);
    entity.send(generationEvent);
    components=generationEvent.getResultComponents();
  }
  for (  Component c : components) {
    store.put(entity.getId(),c);
  }
  if (eventSystem != null) {
    eventSystem.send(entity,OnAddedComponent.newInstance());
    eventSystem.send(entity,OnActivatedComponent.newInstance());
  }
  return entity;
}
