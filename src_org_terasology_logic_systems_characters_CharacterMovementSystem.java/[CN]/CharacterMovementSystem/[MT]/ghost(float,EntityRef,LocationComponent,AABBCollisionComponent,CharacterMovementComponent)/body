{
  Vector3f desiredVelocity=new Vector3f(movementComp.getDrive());
  float maxSpeed=movementComp.maxGhostSpeed;
  if (movementComp.isRunning) {
    maxSpeed*=movementComp.runFactor;
  }
  desiredVelocity.scale(maxSpeed);
  Vector3f velocityDiff=new Vector3f(desiredVelocity);
  velocityDiff.sub(movementComp.getVelocity());
  float changeMag=velocityDiff.length();
  if (changeMag > GhostInertia * delta) {
    velocityDiff.scale(GhostInertia * delta / changeMag);
  }
  movementComp.getVelocity().add(velocityDiff);
  Vector3f worldPos=location.getWorldPosition();
  Vector3f deltaPos=new Vector3f(movementComp.getVelocity());
  deltaPos.scale(delta);
  worldPos.add(deltaPos);
  location.setWorldPosition(worldPos);
  if (movementComp.faceMovementDirection) {
    float yaw=(float)Math.atan2(movementComp.getVelocity().x,movementComp.getVelocity().z);
    AxisAngle4f axisAngle=new AxisAngle4f(0,1,0,yaw);
    location.getLocalRotation().set(axisAngle);
  }
}
