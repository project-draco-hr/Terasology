{
  SimpleNetwork addToNetwork=null;
  Map<Vector3i,Byte> networkingNodesToAdd=Maps.newHashMap();
  networkingNodesToAdd.put(location,connectingOnSides);
  Multimap<Vector3i,Byte> newLeafNodes=HashMultimap.create();
  final Iterator<SimpleNetwork> networkIterator=networks.iterator();
  while (networkIterator.hasNext()) {
    final SimpleNetwork network=networkIterator.next();
    if (network.canAddNetworkingNode(location,connectingOnSides)) {
      if (addToNetwork == null) {
        addToNetwork=network;
      }
 else {
        Map<Vector3i,Byte> networkingNodes=Maps.newHashMap(network.getNetworkingNodes());
        Multimap<Vector3i,Byte> leafNodes=HashMultimap.create(network.getLeafNodes());
        networkingNodesToAdd.putAll(networkingNodes);
        newLeafNodes.putAll(leafNodes);
        network.removeAllLeafNodes();
        notifyLeafNodesRemoved(network,leafNodes);
        network.removeAllNetworkingNodes();
        notifyNetworkingNodesRemoved(network,networkingNodes);
        networkIterator.remove();
        notifyNetworkRemoved(network);
      }
    }
  }
  if (addToNetwork == null) {
    SimpleNetwork newNetwork=new SimpleNetwork();
    networks.add(newNetwork);
    notifyNetworkAdded(newNetwork);
    addToNetwork=newNetwork;
  }
  for (  Map.Entry<Vector3i,Byte> networkingNode : networkingNodesToAdd.entrySet())   addToNetwork.addNetworkingNode(networkingNode.getKey(),networkingNode.getValue());
  notifyNetworkingNodesAdded(addToNetwork,networkingNodesToAdd);
  for (  Map.Entry<Vector3i,Byte> leafNode : newLeafNodes.entries())   addToNetwork.addLeafNode(leafNode.getKey(),leafNode.getValue());
  for (  Map.Entry<Vector3i,Byte> leafNode : leafNodes.entries()) {
    final Vector3i leafNodeLocation=leafNode.getKey();
    final byte leafNodeConnectingOnSides=leafNode.getValue();
    if (addToNetwork.canAddLeafNode(leafNodeLocation,leafNodeConnectingOnSides)) {
      addToNetwork.addLeafNode(leafNodeLocation,leafNodeConnectingOnSides);
      newLeafNodes.put(leafNodeLocation,leafNodeConnectingOnSides);
    }
  }
  if (newLeafNodes.size() > 0)   notifyLeafNodesAdded(addToNetwork,newLeafNodes);
}
