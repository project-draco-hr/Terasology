{
  validateNotMutating();
  mutating=true;
  try {
    final NetworkNode networkNode=new NetworkNode(location,connectingOnSides);
    for (    SimpleNetwork network : networks) {
      if (network.canAddLeafNode(networkNode)) {
        network.addLeafNode(networkNode);
        notifyLeafNodesAdded(network,toMultimap(Collections.singleton(networkNode)));
      }
    }
    for (    NetworkNode leafNode : leafNodes) {
      if (SimpleNetwork.areNodesConnecting(networkNode,leafNode)) {
        SimpleNetwork degenerateNetwork=SimpleNetwork.createDegenerateNetwork(networkNode,leafNode);
        networks.add(degenerateNetwork);
        notifyNetworkAdded(degenerateNetwork);
        notifyLeafNodesAdded(degenerateNetwork,toMultimap(Sets.newHashSet(networkNode,leafNode)));
      }
    }
    leafNodes.add(networkNode);
  }
  finally {
    mutating=false;
  }
}
