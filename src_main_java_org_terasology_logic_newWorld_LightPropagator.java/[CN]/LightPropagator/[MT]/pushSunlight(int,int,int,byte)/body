{
  Collection<Vector3i> currentWave=Lists.newArrayList();
  Collection<Vector3i> nextWave=Lists.newArrayList();
  nextWave.add(new Vector3i(x,y,z));
  if (lightLevel == NewChunk.MAX_LIGHT && worldView.getSunlight(x,y - 1,z) < NewChunk.MAX_LIGHT) {
    for (int columnY=y - 1; columnY >= 0 && worldView.getBlock(x,columnY,z).isTranslucent(); columnY--) {
      worldView.setSunlight(x,columnY,z,lightLevel);
      nextWave.add(new Vector3i(x,columnY,z));
    }
  }
  Region3i affectedRegion=Region3i.createFromMinAndSize(new Vector3i(x,y,z),Vector3i.one());
  while (lightLevel > 1 && !nextWave.isEmpty()) {
    Collection<Vector3i> temp=currentWave;
    currentWave=nextWave;
    nextWave=temp;
    nextWave.clear();
    if (lightLevel < NewChunk.MAX_LIGHT) {
      for (      Vector3i pos : currentWave) {
        if (pos.y < NewChunk.SIZE_Y - 2) {
          Vector3i adjPos=new Vector3i(pos.x,pos.y + 1,pos.z);
          Block block=worldView.getBlock(adjPos);
          if (block.isTranslucent()) {
            byte adjLight=worldView.getSunlight(adjPos);
            if (adjLight < lightLevel - 1) {
              worldView.setSunlight(adjPos,(byte)(lightLevel - 1));
              nextWave.add(adjPos);
              affectedRegion=affectedRegion.expandToContain(adjPos);
            }
          }
        }
        if (pos.y > 0) {
          Vector3i adjPos=new Vector3i(pos.x,pos.y - 1,pos.z);
          Block block=worldView.getBlock(adjPos);
          if (block.isTranslucent()) {
            byte adjLight=worldView.getSunlight(adjPos);
            if (adjLight < lightLevel - 1) {
              worldView.setSunlight(adjPos,(byte)(lightLevel - 1));
              nextWave.add(adjPos);
              affectedRegion=affectedRegion.expandToContain(adjPos);
            }
          }
        }
      }
    }
    for (    Vector3i pos : currentWave) {
      for (      Side side : Side.horizontalSides()) {
        Vector3i adjPos=new Vector3i(pos);
        adjPos.add(side.getVector3i());
        Block block=worldView.getBlock(adjPos);
        if (block.isTranslucent()) {
          byte adjLight=worldView.getSunlight(adjPos);
          if (adjLight < lightLevel - 1) {
            worldView.setSunlight(adjPos,(byte)(lightLevel - 1));
            nextWave.add(adjPos);
            affectedRegion=affectedRegion.expandToContain(adjPos);
          }
        }
      }
    }
    lightLevel--;
  }
  return affectedRegion;
}
