{
  BlockFamily family;
  if (isFreeformFamily(familyUri)) {
    family=blockLoader.loadWithShape(familyUri);
  }
 else {
    family=getAvailableBlockFamily(familyUri);
  }
  if (family != null) {
    for (    Block block : family.getBlocks()) {
      Integer id=registration.get(block.getURI().toString());
      if (id != null) {
        block.setId((short)id.intValue());
      }
 else {
        logger.error("Missing id for block {} in registered family {}",block.getURI(),familyUri);
        block.setId(UNKNOWN_ID);
      }
    }
    registerFamily(family);
  }
 else {
    logger.error("Block family not available: {}",familyUri);
  }
}
