{
  Multimap<Class<? extends Component>,EventHandlerInfo> handlers=componentSpecificHandlers.get(event.getClass());
  if (handlers == null)   return;
  Set<EventHandlerInfo> selectedHandlersSet=Sets.newHashSet();
  for (  Class<? extends Component> compClass : handlers.keySet()) {
    if (entity.hasComponent(compClass)) {
      for (      EventHandlerInfo eventHandler : handlers.get(compClass)) {
        if (eventHandler.isValidFor(entity)) {
          selectedHandlersSet.add(eventHandler);
        }
      }
    }
  }
  List<EventHandlerInfo> selectedHandlers=Lists.newArrayList(selectedHandlersSet);
  Collections.sort(selectedHandlers,priorityComparator);
  for (  EventHandlerInfo handler : selectedHandlers) {
    if (handler.isValidFor(entity)) {
      handler.invoke(entity,event);
      if (event.isCancelled())       return;
    }
  }
}
