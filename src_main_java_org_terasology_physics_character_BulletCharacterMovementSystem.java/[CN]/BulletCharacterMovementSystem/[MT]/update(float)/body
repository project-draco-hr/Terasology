{
  for (  EntityRef entity : entityManager.iteratorEntities(CharacterMovementComponent.class,LocationComponent.class)) {
    LocationComponent location=entity.getComponent(LocationComponent.class);
    if (!worldProvider.isBlockActive(location.getWorldPosition()))     continue;
    CharacterMovementComponent movementComp=entity.getComponent(CharacterMovementComponent.class);
    if (movementComp.collider == null) {
      float height=(movementComp.height - 2 * movementComp.radius) * location.getWorldScale();
      float width=movementComp.radius * location.getWorldScale();
      ConvexShape capsule=new CapsuleShape(width,height);
      movementComp.collider=physics.createCollider(location.getWorldPosition(),capsule,CollisionFilterGroups.CHARACTER_FILTER,(short)(CollisionFilterGroups.STATIC_FILTER | CollisionFilterGroups.DEFAULT_FILTER | CollisionFilterGroups.SENSOR_TRIGGER),CollisionFlags.CHARACTER_OBJECT);
      movementComp.collider.setUserPointer(entity);
      capsule.setMargin(0.05f);
    }
    updatePosition(delta,entity,location,movementComp);
    updateSwimStatus(location,movementComp);
    entity.saveComponent(location);
    entity.saveComponent(movementComp);
  }
}
