{
  for (  EntityRef entity : entityManager.iteratorEntities(CharacterMovementComponent.class,LocationComponent.class)) {
    LocationComponent location=entity.getComponent(LocationComponent.class);
    if (!worldProvider.isBlockActive(location.getWorldPosition())) {
      continue;
    }
    CharacterMovementComponent movementComp=entity.getComponent(CharacterMovementComponent.class);
    if (movementComp.collider == null) {
      float height=(movementComp.height - 2 * movementComp.radius) * location.getWorldScale();
      float width=movementComp.radius * location.getWorldScale();
      ConvexShape capsule=new CapsuleShape(width,height);
      capsule.setMargin(0.1f);
      movementComp.collider=physics.createCollider(location.getWorldPosition(),capsule,Lists.<CollisionGroup>newArrayList(movementComp.collisionGroup),movementComp.collidesWith,CollisionFlags.CHARACTER_OBJECT);
      movementComp.collider.setUserPointer(entity);
      continue;
    }
    updatePosition(delta,entity,location,movementComp);
    updateSwimStatus(location,movementComp);
    entity.saveComponent(location);
    entity.saveComponent(movementComp);
  }
}
