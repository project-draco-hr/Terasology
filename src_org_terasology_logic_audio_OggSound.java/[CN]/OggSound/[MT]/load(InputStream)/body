{
  if (stream == null) {
    throw new IllegalArgumentException("Sound stream is null");
  }
  try {
    ByteArrayOutputStream bos=new ByteArrayOutputStream();
    OggReader reader=new OggReader(stream);
    FileOutputStream fos=new FileOutputStream("test.wav");
    byte buffer[]=new byte[1024];
    int read;
    int totalRead=0;
    do {
      read=reader.read(buffer,0,buffer.length);
      if (read < 0) {
        break;
      }
      totalRead+=read;
      bos.write(buffer,0,read);
      fos.write(buffer,0,read);
    }
 while (read > 0);
    buffer=bos.toByteArray();
    ByteBuffer data=BufferUtils.createByteBuffer(totalRead).put(buffer);
    data.flip();
    this.channels=reader.getChannels();
    int sampleRate=reader.getRate();
    AL10.alBufferData(this.getBufferId(),this.channels == 1 ? AL10.AL_FORMAT_MONO16 : AL10.AL_FORMAT_STEREO16,data,sampleRate);
    OpenALException.checkState("Uploading buffer");
  }
 catch (  IOException e) {
    throw new IllegalStateException("Failed to load sound: " + e.getMessage(),e);
  }
}
