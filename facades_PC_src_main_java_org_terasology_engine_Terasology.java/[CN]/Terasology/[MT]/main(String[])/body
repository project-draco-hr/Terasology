{
  boolean crashReportEnabled=true;
  try {
    boolean isHeadless=false;
    Path homePath=null;
    for (    String arg : args) {
      if (arg.startsWith(HOME_ARG)) {
        homePath=Paths.get(arg.substring(HOME_ARG.length()));
      }
 else       if (arg.equals(LOCAL_ARG)) {
        homePath=Paths.get("");
      }
 else       if (arg.equals(HEADLESS_ARG)) {
        isHeadless=true;
      }
 else       if (arg.equals(NO_CRASH_REPORT_ARG)) {
        crashReportEnabled=false;
      }
    }
    if (homePath != null) {
      PathManager.getInstance().useOverrideHomePath(homePath);
    }
 else {
      PathManager.getInstance().useDefaultHomePath();
    }
    Collection<EngineSubsystem> subsystemList;
    if (isHeadless) {
      subsystemList=Lists.newArrayList(new HeadlessGraphics(),new HeadlessTimer(),new HeadlessAudio(),new HeadlessInput());
    }
 else {
      subsystemList=Lists.<EngineSubsystem>newArrayList(new LwjglGraphics(),new LwjglTimer(),new LwjglAudio(),new LwjglInput());
    }
    TerasologyEngine engine=new TerasologyEngine(subsystemList);
    try {
      engine.init();
      if (isHeadless) {
        engine.subscribeToStateChange(new HeadlessStateChangeListener());
        engine.run(new StateHeadlessSetup());
      }
 else {
        engine.run(new StateMainMenu());
      }
    }
  finally {
      try {
        engine.dispose();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
 catch (  RuntimeException|IOException e) {
    if (!GraphicsEnvironment.isHeadless()) {
      Path logPath=Paths.get(".");
      try {
        Path gameLogPath=PathManager.getInstance().getLogPath();
        if (gameLogPath != null) {
          logPath=gameLogPath;
        }
      }
 catch (      Exception eat) {
      }
      if (crashReportEnabled) {
        Path logFile=logPath.resolve("Terasology.log");
        CrashReporter.report(e,logFile);
      }
    }
  }
}
