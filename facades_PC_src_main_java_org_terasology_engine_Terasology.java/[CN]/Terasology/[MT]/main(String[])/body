{
  try {
    boolean isHeadless=false;
    Path homePath=null;
    for (    String arg : args) {
      if (arg.startsWith(HOME_ARG)) {
        homePath=Paths.get(arg.substring(HOME_ARG.length()));
      }
 else       if (arg.equals(LOCAL_ARG)) {
        homePath=Paths.get("");
      }
 else       if (arg.equals(HEADLESS_ARG)) {
        isHeadless=true;
      }
    }
    if (homePath != null) {
      PathManager.getInstance().useOverrideHomePath(homePath);
    }
 else {
      PathManager.getInstance().useDefaultHomePath();
    }
    Collection<EngineSubsystem> subsystemList;
    if (isHeadless) {
      subsystemList=Lists.newArrayList(new HeadlessGraphics(),new HeadlessTimer(),new HeadlessAudio(),new HeadlessInput());
    }
 else {
      subsystemList=Lists.<EngineSubsystem>newArrayList(new LwjglGraphics(),new LwjglTimer(),new LwjglAudio(),new LwjglInput());
    }
    TerasologyEngine engine=new TerasologyEngine(subsystemList);
    try {
      engine.init();
      if (isHeadless) {
        engine.run(new StateHeadlessSetup());
      }
 else {
        engine.run(new StateMainMenu());
      }
    }
  finally {
      try {
        engine.dispose();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
 catch (  Throwable t) {
    if (!GraphicsEnvironment.isHeadless()) {
      Path logDirectory=Paths.get(".");
      try {
        logDirectory=PathManager.getInstance().getLogPath();
      }
 catch (      Exception e) {
      }
      Path logPath=logDirectory.resolve("Terasology.log");
      CrashReporter.report(t,logPath);
    }
  }
  System.exit(0);
}
