{
  Preconditions.checkNotNull(array,"The parameter 'array' must not be null");
  final Class<? extends TeraArray> cls=array.getClass();
  final ChunksProtobuf.TeraArray.Builder b=ChunksProtobuf.TeraArray.newBuilder();
  final ChunksProtobuf.Type t=Preconditions.checkNotNull(getProtobufType(cls),"The method TeraArray:getProtobufType() must not return null");
  final TeraArray.SerializationHandler handler=Preconditions.checkNotNull(getSerializationHandler(cls),"No serialization handler found for tera array of class: " + cls.getName());
  final ByteBuffer buf=handler.serialize(array,null);
  buf.rewind();
  b.setData(ByteString.copyFrom(buf));
  b.setType(t);
  if (t == ChunksProtobuf.Type.Unknown)   b.setClassName(cls.getName());
  return b.build();
}
