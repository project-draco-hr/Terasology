{
  DensityFacet solidityFacet=chunkRegion.getFacet(DensityFacet.class);
  SurfaceHeightFacet surfaceFacet=chunkRegion.getFacet(SurfaceHeightFacet.class);
  BiomeFacet biomeFacet=chunkRegion.getFacet(BiomeFacet.class);
  Float3DIterator iterator=solidityFacet.get();
  while (iterator.hasNext()) {
    float density=iterator.next();
    if (density >= 32) {
      chunk.setBlock(iterator.currentPosition(),stone);
    }
 else     if (density >= 0) {
      int depth=TeraMath.floorToInt(surfaceFacet.get(iterator.current2DPos())) - iterator.currentPosition().getY() - chunk.getChunkWorldOffsetY();
      WorldBiomeProvider.Biome biome=biomeFacet.get(iterator.currentPosition().getX(),iterator.currentPosition().getZ());
      Block block=getSurfaceBlock(depth,iterator.currentPosition().getY() + chunk.getChunkWorldOffsetY(),biome);
      chunk.setBlock(iterator.currentPosition(),block);
    }
 else {
      int posY=iterator.currentPosition().getY() + chunk.getChunkWorldOffsetY();
      if (posY == 32 && WorldBiomeProvider.Biome.SNOW == biomeFacet.get(iterator.currentPosition().getX(),iterator.currentPosition().getZ())) {
        chunk.setBlock(iterator.currentPosition(),ice);
      }
 else       if (posY <= 32) {
        chunk.setBlock(iterator.currentPosition(),water);
      }
    }
  }
}
