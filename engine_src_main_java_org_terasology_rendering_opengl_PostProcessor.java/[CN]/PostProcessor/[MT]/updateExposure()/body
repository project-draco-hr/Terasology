{
  if (renderingConfig.isEyeAdaptation()) {
    FBO scene=renderingProcess.getFBO("scene1");
    if (scene == null) {
      return;
    }
    renderingProcess.getCurrentReadbackPBO().copyFromFBO(scene.fboId,1,1,GL12.GL_BGRA,GL11.GL_UNSIGNED_BYTE);
    renderingProcess.swapReadbackPBOs();
    ByteBuffer pixels=renderingProcess.getCurrentReadbackPBO().readBackPixels();
    if (pixels.limit() < 3) {
      logger.error("Failed to auto-update the exposure value.");
      return;
    }
    currentSceneLuminance=0.2126f * (pixels.get(2) & 0xFF) / 255.f + 0.7152f * (pixels.get(1) & 0xFF) / 255.f + 0.0722f * (pixels.get(0) & 0xFF) / 255.f;
    float targetExposure=hdrMaxExposure;
    if (currentSceneLuminance > 0) {
      targetExposure=hdrTargetLuminance / currentSceneLuminance;
    }
    float maxExposure=hdrMaxExposure;
    if (CoreRegistry.get(BackdropProvider.class).getDaylight() == 0.0) {
      maxExposure=hdrMaxExposureNight;
    }
    if (targetExposure > maxExposure) {
      targetExposure=maxExposure;
    }
 else     if (targetExposure < hdrMinExposure) {
      targetExposure=hdrMinExposure;
    }
    currentExposure=(float)TeraMath.lerp(currentExposure,targetExposure,hdrExposureAdjustmentSpeed);
  }
 else {
    if (CoreRegistry.get(BackdropProvider.class).getDaylight() == 0.0) {
      currentExposure=hdrMaxExposureNight;
    }
 else {
      currentExposure=hdrExposureDefault;
    }
  }
}
