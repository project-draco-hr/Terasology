{
  Context context=new ContextImpl();
  context.put(ModuleManager.class,moduleManager);
  AssetManager assetManager=mock(AssetManager.class);
  context.put(AssetManager.class,assetManager);
  CoreRegistry.setContext(context);
  when(assetManager.listLoadedAssets(AssetType.PREFAB,Prefab.class)).thenReturn(Collections.<Prefab>emptyList());
  EntitySystemSetupUtil.addReflectionBasedLibraries(context);
  EntitySystemSetupUtil.addEntityManagementRelatedClasses(context);
  entityManager=context.get(EngineEntityManager.class);
  entityManager.getComponentLibrary().register(new SimpleUri("test","gettersetter"),GetterSetterComponent.class);
  entityManager.getComponentLibrary().register(new SimpleUri("test","string"),StringComponent.class);
  entityManager.getComponentLibrary().register(new SimpleUri("test","integer"),IntegerComponent.class);
  worldSerializer=new WorldSerializerImpl(entityManager,new PrefabSerializer(entityManager.getComponentLibrary(),entityManager.getTypeSerializerLibrary()));
}
