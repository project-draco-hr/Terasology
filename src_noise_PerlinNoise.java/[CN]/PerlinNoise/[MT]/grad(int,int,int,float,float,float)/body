{
  int h=noisePerm[(noisePerm[(noisePerm[x % noisePerm.length] + y) % noisePerm.length] + z) % noisePerm.length];
  h&=15;
  float u=h < 8 || h == 12 || h == 13 ? dx : dy;
  float v=h < 4 || h == 12 || h == 13 ? dy : dz;
  return ((h & 1) == 0 ? u : -u) + ((h & 2) == 0 ? v : -v);
}
