{
  T component=minion.getComponent(type);
  if (component == null) {
    ComponentMetadata<T> metadata=CoreRegistry.get(EntitySystemLibrary.class).getComponentLibrary().getMetadata(type);
    if (metadata == null || !metadata.isConstructable()) {
      throw new RuntimeException("Cannot create component for " + type);
    }
    component=metadata.newInstance();
    minion.addComponent(component);
  }
  return component;
}
