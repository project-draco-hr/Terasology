{
  ChunkMonitor.fireChunkProviderDisposed(this);
  pipeline.shutdown();
  unloadRequestTaskMaster.shutdown(new ChunkUnloadRequest(),true);
  for (  ChunkImpl chunk : nearCache.values()) {
    worldEntity.send(new BeforeChunkUnload(chunk.getPos()));
    chunk.dispose();
    ChunkStore store=storageManager.createChunkStoreForSave(chunk);
    store.storeAllEntities();
    store.save();
  }
  nearCache.clear();
  storageManager.purgeChunks();
  this.pipeline=new ChunkGenerationPipeline(this,generator,new ChunkTaskRelevanceComparator());
  this.unloadRequestTaskMaster=TaskMaster.createFIFOTaskMaster("Chunk-Unloader",8);
  ChunkMonitor.fireChunkProviderInitialized(this);
  for (  ChunkRelevanceRegion chunkRelevanceRegion : regions.values()) {
    pipeline.requestProduction(chunkRelevanceRegion.getRegion().expand(new Vector3i(2,0,2)));
    chunkRelevanceRegion.setUpToDate();
  }
}
