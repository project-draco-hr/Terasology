{
  for (  CacheRegion cacheRegion : regions) {
    cacheRegion.update();
    if (cacheRegion.isDirty()) {
      cacheRegion.setUpToDate();
      checkRegion(cacheRegion);
    }
  }
  while (!generatedChunks.isEmpty()) {
    Vector3i chunkPos=generatedChunks.poll();
    logger.log(Level.FINE,"Received generated chunk " + chunkPos);
    generatingChunks.remove(chunkPos);
    for (    Vector3i pos : Region3i.createFromCenterExtents(chunkPos,new Vector3i(1,0,1))) {
      checkFullGenerate(pos);
    }
  }
  while (!secondPassCompleteChunks.isEmpty()) {
    Vector3i chunkPos=secondPassCompleteChunks.poll();
    logger.log(Level.FINE,"Received second passed chunk " + chunkPos);
    secondPassPendingChunks.remove(chunkPos);
    for (    Vector3i pos : Region3i.createFromCenterExtents(chunkPos,new Vector3i(2,0,2))) {
      checkComplete(pos);
    }
  }
  if (nearCache.size() > CACHE_SIZE) {
    logger.log(Level.INFO,"Compacting cache");
    Iterator<Vector3i> iterator=nearCache.keySet().iterator();
    while (iterator.hasNext()) {
      Vector3i pos=iterator.next();
      boolean keep=false;
      for (      CacheRegion region : regions) {
        if (region.getRegion().encompasses(pos)) {
          keep=true;
          break;
        }
      }
      if (!keep) {
        NewChunk chunk=nearCache.get(pos);
        farCache.put(chunk);
        iterator.remove();
        chunk.dispose();
      }
    }
  }
}
