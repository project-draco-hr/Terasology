{
  long startTime=1000 * Sys.getTime() / Sys.getTimerResolution();
  while (current != null && 1000 * Sys.getTime() / Sys.getTimerResolution() - startTime < 20) {
    if (current.step()) {
      popStep();
    }
  }
  if (current == null) {
    CoreRegistry.get(GUIManager.class).closeWindow("loading");
    CoreRegistry.get(GameEngine.class).changeState(new StateIngame());
  }
 else {
    loadingScreen.updateStatus(current.getMessage(),100f * current.getProgress());
    guiManager.update();
  }
}
