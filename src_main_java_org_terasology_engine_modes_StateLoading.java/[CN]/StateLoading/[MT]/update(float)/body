{
  long startTime=1000 * Sys.getTime() / Sys.getTimerResolution();
  while (current != null && 1000 * Sys.getTime() / Sys.getTimerResolution() - startTime < 20) {
    if (current.step()) {
      popStep();
    }
 else {
      completedSteps++;
    }
  }
  if (current == null) {
    CoreRegistry.get(GUIManager.class).closeWindow("loading");
    CoreRegistry.get(GameEngine.class).changeState(new StateIngame());
  }
 else {
    if (currentExpectedSteps > 0) {
      loadingScreen.updateStatus(current.getMessage(),100f * completedSteps / currentExpectedSteps);
    }
 else {
      loadingScreen.updateStatus(current.getMessage(),0);
    }
    guiManager.update();
  }
}
