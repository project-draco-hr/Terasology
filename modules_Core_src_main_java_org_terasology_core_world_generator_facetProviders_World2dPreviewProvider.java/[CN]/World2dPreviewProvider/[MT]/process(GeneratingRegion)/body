{
  World2dPreviewFacet facet=new World2dPreviewFacet();
  SurfaceHeightFacet surfaceFacet=region.getRegionFacet(SurfaceHeightFacet.class);
  SeaLevelFacet seaLevelFacet=region.getRegionFacet(SeaLevelFacet.class);
  float seaLevel=seaLevelFacet.getSeaLevel();
  float[] values=surfaceFacet.getInternal();
  float total=0;
  int sampleRate=Math.max(1,region.getRegion().sizeX() / maxSamplesPerRegion);
  for (int i=0; i < values.length; i++) {
    if (i % sampleRate == 0) {
      total+=values[i];
    }
  }
  float average=total / (values.length / sampleRate);
  if (average < seaLevel) {
    facet.setColor(new Color(0,0,TeraMath.clamp((int)(255 * (1.0 - (Math.abs(average - seaLevel) / maxDepthDescribed))),100,255)));
  }
 else {
    facet.setColor(new Color(0,TeraMath.clamp((int)(255 * (1.0 - ((average - seaLevel) / maxHeightDescribed))),100,255),0));
  }
  region.setRegionFacet(World2dPreviewFacet.class,facet);
}
