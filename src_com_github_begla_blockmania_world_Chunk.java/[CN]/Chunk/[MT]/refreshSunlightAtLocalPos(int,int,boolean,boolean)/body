{
  boolean covered=false;
  for (int y=(int)Configuration.CHUNK_DIMENSIONS.y - 1; y >= 0; y--) {
    Block b=Block.getBlockForType(_blocks.get(x,y,z));
    if ((!b.isBlockInvisible() && b.getBlockForm() != Block.BLOCK_FORM.BILLBOARD) && !covered) {
      covered=true;
    }
    byte oldValue=_sunlight.get(x,y,z);
    byte newValue;
    if (!covered) {
      if (b.isBlockInvisible() || b.getBlockForm() == Block.BLOCK_FORM.BILLBOARD)       _sunlight.set(x,y,z,Configuration.MAX_LIGHT);
 else       _sunlight.set(x,y,z,(byte)0x0);
      newValue=_sunlight.get(x,y,z);
    }
 else {
      _sunlight.set(x,y,z,(byte)0);
      if (refreshSunlight) {
        refreshLightAtLocalPos(x,y,z,LIGHT_TYPE.SUN);
      }
      newValue=_sunlight.get(x,y,z);
    }
    if (spreadLight && oldValue > newValue)     unspreadLight(x,y,z,oldValue,Chunk.LIGHT_TYPE.SUN);
 else     if (spreadLight && oldValue < newValue) {
      spreadLight(x,y,z,newValue,LIGHT_TYPE.SUN);
    }
  }
}
