{
  CharacterMovementComponent charMoveComp=localPlayer.getCharacterEntity().getComponent(CharacterMovementComponent.class);
  float bobOffset=calcBobbingOffset(charMoveComp.footstepDelta / charMoveComp.distanceBetweenFootsteps,(float)java.lang.Math.PI / 8f,0.05f,1f);
  float handMovementAnimationOffset=localPlayer.getCharacterEntity().getComponent(LocalPlayerComponent.class).handAnimation;
  UIItemContainer toolbar=(UIItemContainer)CoreRegistry.get(GUIManager.class).getWindowById("hud").getElementById("toolbar");
  int invSlotIndex=localPlayer.getCharacterEntity().getComponent(LocalPlayerComponent.class).selectedTool + toolbar.getSlotStart();
  EntityRef heldItem=localPlayer.getCharacterEntity().getComponent(InventoryComponent.class).itemSlots.get(invSlotIndex);
  ItemComponent heldItemComp=heldItem.getComponent(ItemComponent.class);
  BlockItemComponent blockItem=heldItem.getComponent(BlockItemComponent.class);
  if (blockItem != null && blockItem.blockFamily != null) {
    renderBlock(blockItem.blockFamily,bobOffset,handMovementAnimationOffset);
  }
 else   if (heldItemComp != null && heldItemComp.renderWithIcon) {
    renderIcon(heldItemComp.icon,bobOffset,handMovementAnimationOffset);
  }
 else {
    renderHand(bobOffset,handMovementAnimationOffset);
  }
}
