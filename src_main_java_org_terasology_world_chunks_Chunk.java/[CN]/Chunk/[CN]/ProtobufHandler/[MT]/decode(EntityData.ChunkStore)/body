{
  Preconditions.checkNotNull(message,"The parameter 'message' must not be null");
  if (!message.hasX() || !message.hasY() || !message.hasZ()) {
    throw new IllegalArgumentException("Ill-formed protobuf message. Missing chunk position.");
  }
  Vector3i pos=new Vector3i(message.getX(),message.getY(),message.getZ());
  if (!message.hasState()) {
    throw new IllegalArgumentException("Ill-formed protobuf message. Missing chunk state.");
  }
  State state=State.lookup(message.getState());
  if (!message.hasBlockData()) {
    throw new IllegalArgumentException("Ill-formed protobuf message. Missing block data.");
  }
  final TeraArrays t=TeraArrays.getInstance();
  final TeraArray blockData=t.decode(message.getBlockData());
  Chunks c=Chunks.getInstance();
  TeraArray sunlightData;
  if (message.hasSunlightData()) {
    sunlightData=t.decode(message.getSunlightData());
  }
 else {
    sunlightData=c.getSunlightDataEntry().factory.create(SIZE_X,SIZE_Y,SIZE_Z);
    if (state == State.COMPLETE) {
      state=State.INTERNAL_LIGHT_GENERATION_PENDING;
    }
  }
  TeraArray lightData;
  if (message.hasLightData()) {
    lightData=t.decode(message.getLightData());
  }
 else {
    lightData=c.getLightDataEntry().factory.create(SIZE_X,SIZE_Y,SIZE_Z);
    if (state == State.COMPLETE) {
      state=State.INTERNAL_LIGHT_GENERATION_PENDING;
    }
  }
  TeraArray extraData;
  if (message.hasLiquidData()) {
    extraData=t.decode(message.getLiquidData());
  }
 else {
    extraData=c.getExtraDataEntry().factory.create(SIZE_X,SIZE_Y,SIZE_Z);
  }
  return new Chunk(pos,state,blockData,sunlightData,lightData,extraData,state == State.COMPLETE);
}
