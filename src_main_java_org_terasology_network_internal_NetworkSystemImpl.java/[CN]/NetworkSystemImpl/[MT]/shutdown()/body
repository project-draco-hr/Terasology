{
  if (mode != NetworkMode.NONE) {
    allChannels.close().awaitUninterruptibly();
    factory.releaseExternalResources();
  }
  processPendingDisconnects();
  for (  Client client : clientList) {
    processRemovedClient(client);
  }
  mode=NetworkMode.NONE;
  server=null;
  nextNetId=1;
  netIdToEntityId.clear();
  if (this.entityManager != null) {
    for (    EntityRef entity : entityManager.listEntitiesWith(NetworkComponent.class)) {
      NetworkComponent netComp=entity.getComponent(NetworkComponent.class);
      netComp.setNetworkId(0);
      entity.saveComponent(netComp);
    }
    this.entityManager.unsubscribe(this);
  }
  entityManager=null;
  entitySystemLibrary=null;
  eventSerializer=null;
  entitySerializer=null;
  clientList.clear();
  netClientList.clear();
  logger.info("Network shutdown");
}
