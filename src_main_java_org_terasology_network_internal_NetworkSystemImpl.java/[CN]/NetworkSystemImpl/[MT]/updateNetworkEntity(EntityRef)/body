{
  NetworkComponent netComponent=entity.getComponent(NetworkComponent.class);
  EntityRef lastOwnerEntity=ownerLookup.get(entity);
  if (lastOwnerEntity == null) {
    lastOwnerEntity=EntityRef.NULL;
  }
  if (!Objects.equal(lastOwnerEntity,netComponent.owner)) {
    NetClient lastOwner=(lastOwnerEntity == null) ? null : getNetOwner(lastOwnerEntity);
    NetClient newOwner=getNetOwner(netComponent.owner);
    if (!Objects.equal(lastOwner,newOwner)) {
      recursiveUpdateOwnership(entity,lastOwner,newOwner);
      int id=netComponent.getNetworkId();
      for (      Component component : entity.iterateComponents()) {
        if (entitySystemLibrary.getComponentLibrary().getMetadata(component.getClass()).isReplicated()) {
          newOwner.setComponentDirty(id,component.getClass());
        }
      }
    }
    if (lastOwnerEntity.exists()) {
      ownedLookup.remove(lastOwnerEntity,entity);
    }
    if (netComponent.owner.exists()) {
      ownerLookup.put(entity,netComponent.owner);
      ownedLookup.put(netComponent.owner,entity);
    }
 else {
      ownerLookup.remove(entity);
    }
  }
}
