{
  NetworkComponent netComponent=entity.getComponent(NetworkComponent.class);
  if (netComponent.getNetworkId() == NULL_NET_ID) {
    return;
  }
  EntityRef lastOwnerEntity=ownerLookup.get(entity);
  if (lastOwnerEntity == null) {
    lastOwnerEntity=EntityRef.NULL;
  }
  if (!Objects.equal(lastOwnerEntity,netComponent.owner)) {
    NetClient lastOwner=getNetOwner(lastOwnerEntity);
    NetClient newOwner=getNetOwner(netComponent.owner);
    if (!Objects.equal(lastOwner,newOwner)) {
      recursiveUpdateOwnership(entity,lastOwner,newOwner);
      if (newOwner != null) {
        int id=netComponent.getNetworkId();
        for (        Component component : entity.iterateComponents()) {
          if (entitySystemLibrary.getComponentLibrary().getMetadata(component.getClass()).isReplicated()) {
            newOwner.setComponentDirty(id,component.getClass());
          }
        }
      }
    }
    if (lastOwnerEntity.exists()) {
      ownedLookup.remove(lastOwnerEntity,entity);
    }
    if (netComponent.owner.exists()) {
      ownerLookup.put(entity,netComponent.owner);
      ownedLookup.put(netComponent.owner,entity);
    }
 else {
      ownerLookup.remove(entity);
    }
  }
}
