{
  ModuleManager moduleManager=context.get(ModuleManager.class);
  Config config=context.get(Config.class);
  Set<Module> selectedModules=Sets.newHashSet();
  for (  Name moduleName : config.getDefaultModSelection().listModules()) {
    Module module=moduleManager.getRegistry().getLatestModuleVersion(moduleName);
    if (module != null) {
      selectedModules.add(module);
      for (      DependencyInfo dependencyInfo : module.getMetadata().getDependencies()) {
        selectedModules.add(moduleManager.getRegistry().getLatestModuleVersion(dependencyInfo.getId()));
      }
    }
  }
  ModuleEnvironment environment=moduleManager.loadEnvironment(selectedModules,false);
  context.get(ModuleAwareAssetTypeManager.class).switchEnvironment(environment);
  return environment;
}
