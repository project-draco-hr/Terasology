{
  ComponentSystemManager componentSystemManager=CoreRegistry.get(ComponentSystemManager.class);
  for (  ComponentSystem sys : componentSystemManager.iterateAll()) {
    sys.preSave();
  }
  terasologyEngine.stopThreads();
  StorageManager storageManager=CoreRegistry.get(StorageManager.class);
  if (storageManager != null) {
    GameManifest gameManifest=createGameManifest();
    saveGameManifest(gameManifest);
    try {
      storageManager.flush();
    }
 catch (    IOException e) {
      logger.error("Failed to save game",e);
    }
    storageManager.shutdown();
  }
  terasologyEngine.restartThreads();
  for (  ComponentSystem sys : componentSystemManager.iterateAll()) {
    sys.postSave();
  }
}
