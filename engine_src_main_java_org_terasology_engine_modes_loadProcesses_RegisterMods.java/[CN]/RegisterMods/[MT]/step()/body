{
  ModuleManager moduleManager=CoreRegistry.get(ModuleManager.class);
  List<Name> moduleIds=Lists.newArrayListWithCapacity(gameManifest.getModules().size());
  for (  NameVersion moduleInfo : gameManifest.getModules()) {
    moduleIds.add(moduleInfo.getName());
  }
  DependencyResolver resolver=new DependencyResolver(moduleManager.getRegistry());
  ResolutionResult result=resolver.resolve(moduleIds);
  if (result.isSuccess()) {
    ModuleEnvironment env=moduleManager.loadEnvironment(result.getModules(),true);
    for (    Module moduleInfo : env.getModulesOrderedByDependencies()) {
      logger.info("Activating module: {}:{}",moduleInfo.getId(),moduleInfo.getVersion());
    }
    ApplyModulesUtil.applyModules();
  }
 else {
    CoreRegistry.get(GameEngine.class).changeState(new StateMainMenu("Missing required module or dependency"));
  }
  return true;
}
