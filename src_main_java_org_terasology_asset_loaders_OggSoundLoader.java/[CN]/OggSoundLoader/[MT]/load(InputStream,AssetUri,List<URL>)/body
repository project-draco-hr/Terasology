{
  try {
    ByteArrayOutputStream bos=new ByteArrayOutputStream();
    OggReader reader=new OggReader(stream);
    byte buffer[]=new byte[1024];
    int read;
    int totalRead=0;
    do {
      read=reader.read(buffer,0,buffer.length);
      if (read < 0) {
        break;
      }
      totalRead+=read;
      bos.write(buffer,0,read);
    }
 while (read > 0);
    buffer=bos.toByteArray();
    ByteBuffer data=BufferUtils.createByteBuffer(totalRead).put(buffer);
    data.flip();
    int channels=reader.getChannels();
    int sampleRate=reader.getRate();
    int bufferId=alGenBuffers();
    AL10.alBufferData(bufferId,channels == 1 ? AL10.AL_FORMAT_MONO16 : AL10.AL_FORMAT_STEREO16,data,sampleRate);
    OpenALException.checkState("Uploading buffer");
    return new OggSound(uri,bufferId);
  }
 catch (  IOException e) {
    throw new IOException("Failed to load sound: " + e.getMessage(),e);
  }
}
