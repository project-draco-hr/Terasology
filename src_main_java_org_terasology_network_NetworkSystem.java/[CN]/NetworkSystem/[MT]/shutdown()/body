{
  if (mode != NetworkMode.NONE) {
    allChannels.close().awaitUninterruptibly();
    factory.releaseExternalResources();
    logger.info("Network shutdown");
    mode=NetworkMode.NONE;
    server=null;
    serverInfo=null;
    remoteWorldProvider=null;
    nextNetId=1;
    netIdToEntityId.clear();
    eventSerializer=null;
    entityManager=null;
  }
}
