{
  Chunk chunk=new ChunkImpl(CHUNK_POS);
  chunk.setBlock(0,0,0,testBlock);
  ChunkStore chunkStore=esm.createChunkStoreForSave(chunk);
  EntityRef entity=entityManager.create();
  int id=entity.getId();
  chunkStore.store(entity);
  chunkStore.save();
  esm.flush();
  EngineEntityManager newEntityManager=new EntitySystemBuilder().build(moduleManager.getEnvironment(),networkSystem,new ReflectionReflectFactory());
  StorageManager newSM=new StorageManagerInternal(moduleManager.getEnvironment(),newEntityManager,false);
  newSM.loadGlobalStore();
  ChunkStore restored=newSM.loadChunkStore(CHUNK_POS);
  restored.restoreEntities();
  EntityRef ref=newEntityManager.getEntity(id);
  assertTrue(ref.exists());
  assertTrue(ref.isActive());
}
