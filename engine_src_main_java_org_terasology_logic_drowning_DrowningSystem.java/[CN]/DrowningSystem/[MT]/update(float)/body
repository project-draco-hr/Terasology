{
  for (  EntityRef entity : entityManager.getEntitiesWith(DrowningComponent.class,DrownsComponent.class,LocationComponent.class)) {
    DrowningComponent drowning=entity.getComponent(DrowningComponent.class);
    LocationComponent loc=entity.getComponent(LocationComponent.class);
    DrownsComponent drowns=entity.getComponent(DrownsComponent.class);
    if (drowning.isBreathing()) {
      drowning.breathRemaining+=delta * drowns.breathRechargeRate;
    }
 else {
      drowning.breathRemaining-=delta;
    }
    if (drowning.breathRemaining > drowns.breathCapacity) {
      entity.removeComponent(DrowningComponent.class);
    }
 else {
      if (drowning.breathRemaining <= drowns.timeBetweenDrownDamage * -1) {
        EntityRef liquidBlock=blockEntityProvider.getBlockEntityAt(loc.getWorldPosition());
        entity.send(new DoDamageEvent(drowns.drownDamage,EngineDamageTypes.DROWNING.get(),liquidBlock));
        drowning.breathRemaining+=drowns.timeBetweenDrownDamage;
      }
      entity.saveComponent(drowning);
    }
  }
}
