{
  TIntIterator dirtyIterator=netDirty.iterator();
  while (dirtyIterator.hasNext()) {
    int netId=dirtyIterator.next();
    EntityRef entity=networkSystem.getEntity(netId);
    boolean isOwner=networkSystem.getOwner(entity) == this;
    EntityData.PackedEntity entityData=entitySerializer.serialize(entity,addedComponents.get(netId),dirtyComponents.get(netId),removedComponents.get(netId),new ServerComponentFieldCheck(isOwner,false));
    if (entityData != null) {
      NetData.NetMessage message=NetData.NetMessage.newBuilder().setType(NetData.NetMessage.Type.UPDATE_ENTITY).setUpdateEntity(NetData.UpdateEntityMessage.newBuilder().setEntity(entityData).setNetId(netId)).build();
      send(message);
    }
  }
  netDirty.clear();
  addedComponents.clear();
  removedComponents.clear();
  dirtyComponents.clear();
}
