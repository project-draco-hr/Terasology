{
  blockLoader=new BlockLoader();
  BlockLoader.LoadBlockDefinitionResults blockDefinitions=blockLoader.loadBlockDefinitions();
  addBlockFamily(getAirFamily(),true);
  for (  BlockFamily family : blockDefinitions.families) {
    addBlockFamily(family,false);
  }
  for (  FreeformFamily freeformFamily : blockDefinitions.shapelessDefinitions) {
    addFreeformBlockFamily(freeformFamily.uri,freeformFamily.categories);
  }
  blockLoader.buildAtlas();
  nextId=knownBlockMappings.size();
  if (nextId == 0) {
    nextId++;
  }
  for (  String uri : knownBlockMappings.keySet()) {
    BlockUri blockUri=new BlockUri(uri);
    BlockUri familyUri=blockUri.getRootFamilyUri();
    BlockFamily family;
    if (isFreeformFamily(familyUri)) {
      family=blockLoader.loadWithShape(blockUri.getFamilyUri());
    }
 else {
      family=getAvailableBlockFamily(familyUri);
    }
    if (family != null) {
      for (      Block block : family.getBlocks()) {
        Byte id=knownBlockMappings.get(block.getURI().toString());
        if (id != null) {
          block.setId(id);
        }
 else {
          logger.warn("Missing id for block {} in previously used family {}",block.getURI(),family.getURI());
          block.setId((byte)(nextId++));
        }
      }
      registerFamily(family);
    }
 else {
      logger.warn("Block no longer available: {}",uri);
    }
  }
}
