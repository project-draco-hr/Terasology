{
  CoreRegistry.remove(WorldGeneratorPluginLibrary.class);
  if (environment != null) {
    CoreRegistry.get(AssetManager.class).setEnvironment(moduleManager.getEnvironment());
    environment.close();
    environment=null;
  }
  if (previewGen != null) {
    previewGen.close();
    previewGen=null;
  }
  if (worldGenerator.getConfigurator().isPresent()) {
    WorldConfigurator worldConfig=worldGenerator.getConfigurator().get();
    Map<String,Component> params=worldConfig.getProperties();
    if (params != null) {
      config.setModuleConfigs(worldGenerator.getUri(),params);
    }
  }
  super.onClosed();
}
