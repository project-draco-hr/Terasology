{
  if (fromSlot < 0 || fromSlot >= fromInv.itemSlots.size() || toSlot < 0 || toSlot >= toInv.itemSlots.size()) {
    return;
  }
  EntityRef fromItem=fromInv.itemSlots.get(fromSlot);
  ItemComponent fromItemComp=fromItem.getComponent(ItemComponent.class);
  int fromItemStackCount=getStackSize(fromItem,fromItemComp);
  EntityRef toItem=toInv.itemSlots.get(toSlot);
  ItemComponent toItemComp=toItem.getComponent(ItemComponent.class);
  int toItemStackCount=getStackSize(toItem,toItemComp);
  if (fromItemComp != null) {
    if (toItemComp == null) {
      putItemInSlot(fromEntity,fromInv,fromSlot,EntityRef.NULL);
      putItemInSlot(toEntity,toInv,toSlot,fromItem);
    }
 else     if (!fromItemComp.stackId.isEmpty() && Objects.equal(fromItemComp.stackId,toItemComp.stackId)) {
      int amountToTransfer=Math.min(MAX_STACK - toItemStackCount,fromItemStackCount);
      if (amountToTransfer == 0) {
        putItemInSlot(fromEntity,fromInv,fromSlot,EntityRef.NULL);
        putItemInSlot(toEntity,toInv,toSlot,fromItem);
      }
 else {
        setStackSize(toItem,toItemComp,toItemStackCount + amountToTransfer);
        if (amountToTransfer == fromItemStackCount) {
          destroyItem(fromItem,fromInv,fromSlot);
        }
 else {
          setStackSize(fromItem,fromItemComp,fromItemStackCount - amountToTransfer);
        }
      }
    }
 else {
      putItemInSlot(fromEntity,fromInv,fromSlot,toItem);
      putItemInSlot(toEntity,toInv,toSlot,fromItem);
    }
  }
}
