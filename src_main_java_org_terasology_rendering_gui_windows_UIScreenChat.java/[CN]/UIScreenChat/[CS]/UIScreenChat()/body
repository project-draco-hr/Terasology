{
  commandManager=CommandManager.getInstance();
  MessageManager.getInstance().subscribe(chatSubscription);
  setCloseKeys(new int[]{Keyboard.KEY_ESCAPE});
  setCloseBinds(new String[]{ConsoleButton.ID});
  setId("chat");
  setModal(true);
  maximize();
  addVisibilityListener(new VisibilityListener(){
    @Override public void changed(    UIDisplayElement element,    boolean visibility){
      if (visibility) {
        setFocus(inputBox);
      }
    }
  }
);
  inputBox=new UIText();
  inputBox.setSize(new Vector2f(900f,28f));
  inputBox.setBackgroundColor(new Color(255,255,255,200));
  inputBox.setBorderSolid(new Vector4f(1f,1f,1f,1f),new Color(0,0,0));
  inputBox.setVerticalAlign(EVerticalAlign.BOTTOM);
  inputBox.setSelectionColor(Color.gray);
  inputBox.setPosition(new Vector2f(2,-2));
  inputBox.setVisible(true);
  inputBox.addKeyListener(new KeyListener(){
    @Override public void key(    UIDisplayElement element,    KeyEvent event){
      if (event.isDown()) {
        if (event.getKey() == Keyboard.KEY_RETURN) {
          String message=inputBox.getText().trim();
          inputBox.deleteText();
          MessageManager.getInstance().addMessage(message);
          addHistory(message);
          if (message.startsWith(commandPrefix)) {
            message=message.substring(1);
            commandManager.execute(message);
          }
        }
 else         if (event.getKey() == Keyboard.KEY_UP) {
          moveHistory(+1);
          inputBox.setText(getHistory());
          inputBox.setCursorEnd();
        }
 else         if (event.getKey() == Keyboard.KEY_DOWN) {
          moveHistory(-1);
          inputBox.setText(getHistory());
          inputBox.setCursorEnd();
        }
 else         if (event.getKey() == Keyboard.KEY_TAB) {
          String message=inputBox.getText().trim();
          if (message.startsWith(commandPrefix)) {
            String commandName=message.substring(1);
            List<Command> commands=commandManager.getCommandList();
            List<Command> matches=new ArrayList<Command>();
            for (            Command cmd : commands) {
              if (cmd.getName().regionMatches(0,commandName,0,commandName.length())) {
                matches.add(cmd);
              }
            }
            if (matches.size() == 1) {
              inputBox.setText(commandPrefix + matches.get(0).getName());
              inputBox.setCursorEnd();
            }
 else             if (matches.size() > 1) {
              String commandMatches="";
              for (              Command cmd : matches) {
                if (!commandMatches.isEmpty()) {
                  commandMatches+=" ";
                }
                commandMatches+=cmd.getName();
              }
              MessageManager.getInstance().addMessage(commandMatches);
            }
          }
        }
      }
    }
  }
);
  messageList=new UIList();
  messageList.setSize(new Vector2f(900f,400f));
  messageList.setBackgroundColor(new Color(255,255,255,200));
  messageList.setShadow(new Vector4f(0f,3f,3f,0f),EShadowDirection.OUTSIDE,1f);
  messageList.setBorderSolid(new Vector4f(1f,1f,1f,1f),new Color(0,0,0));
  messageList.setVerticalAlign(EVerticalAlign.BOTTOM);
  messageList.setPosition(new Vector2f(2,-32));
  messageList.setPadding(new Vector4f(0f,5f,0f,5f));
  messageList.setDisabled(true);
  messageList.setVisible(true);
  addDisplayElement(inputBox);
  addDisplayElement(messageList);
  startMessage();
}
