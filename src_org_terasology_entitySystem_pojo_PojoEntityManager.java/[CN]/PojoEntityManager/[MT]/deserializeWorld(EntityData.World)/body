{
  nextEntityId=world.getNextEntityId();
  for (  Integer deadId : world.getFreedEntityIdList()) {
    freedIds.add(deadId);
  }
  for (  EntityData.Prefab prefabData : world.getPrefabList()) {
    if (!prefabManager.exists(prefabData.getName())) {
      Prefab prefab=prefabManager.createPrefab(prefabData.getName());
      for (      String parentName : prefabData.getParentNameList()) {
        Prefab parent=prefabManager.getPrefab(parentName);
        if (parent == null) {
          logger.log(Level.SEVERE,"Missing parent prefab (need to fix parent serialization)");
        }
 else {
          prefab.addParent(parent);
        }
      }
      for (      EntityData.Component componentData : prefabData.getComponentList()) {
        Component component=entityPersister.deserializeComponent(componentData);
        if (component != null) {
          prefab.setComponent(component);
        }
      }
    }
  }
  validIds=new TIntHashSet(world.getEntityCount());
  for (  EntityData.Entity entityData : world.getEntityList()) {
    validIds.add(entityData.getId());
  }
  for (  EntityData.Entity entityData : world.getEntityList()) {
    entityPersister.deserializeEntity(entityData);
  }
  validIds=new TIntHashSet();
}
