{
  final EntityData.World.Builder world=serializeWorld();
  File parentFile=file.getParentFile();
  if (parentFile != null) {
    parentFile.mkdirs();
  }
  FileOutputStream out=new FileOutputStream(file);
  BufferedWriter bufferedWriter=new BufferedWriter(new OutputStreamWriter(out));
  try {
switch (format) {
case Binary:
      world.build().writeTo(out);
    out.flush();
  break;
case Text:
TextFormat.print(world.build(),bufferedWriter);
bufferedWriter.flush();
break;
case JSON:
EntityDataJSONFormat.write(bufferedWriter,world.build());
bufferedWriter.flush();
break;
}
}
  finally {
try {
out.close();
}
 catch (IOException e) {
logger.log(Level.SEVERE,"Failed to close file",e);
}
}
}
