{
  byte[] chunkData=null;
  if (storeChunksInZips) {
    chunkData=loadChunkZip(chunkPos);
  }
 else {
    Path chunkPath=storagePathProvider.getChunkPath(chunkPos);
    if (Files.isRegularFile(chunkPath)) {
      try {
        chunkData=Files.readAllBytes(chunkPath);
      }
 catch (      IOException e) {
        logger.error("Failed to load chunk {}",chunkPos,e);
      }
    }
  }
  ChunkStore store=null;
  if (chunkData != null) {
    TIntSet validRefs=null;
    StoreMetadata table=storeMetadata.get(new ChunkStoreId(chunkPos));
    if (table != null) {
      validRefs=table.getExternalReferences();
    }
    ByteArrayInputStream bais=new ByteArrayInputStream(chunkData);
    try (GZIPInputStream gzipIn=new GZIPInputStream(bais)){
      EntityData.ChunkStore storeData=EntityData.ChunkStore.parseFrom(gzipIn);
      store=new ChunkStoreInternal(storeData,validRefs,this,entityManager);
    }
 catch (    IOException e) {
      logger.error("Failed to read existing saved chunk {}",chunkPos);
    }
  }
  return store;
}
