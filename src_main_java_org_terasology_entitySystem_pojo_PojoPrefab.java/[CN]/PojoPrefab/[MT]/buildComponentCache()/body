{
  Map<Class<? extends Component>,Component> oldCache=componentCache;
  componentCache=Maps.newHashMap();
  for (  Prefab ref : this.getParents()) {
    for (    Component component : ref.iterateComponents()) {
      componentCache.put(component.getClass(),componentLibrary.copy(component));
    }
  }
  if (oldCache != null) {
    for (    Component component : oldCache.values()) {
      if (!component.equals(componentCache.get(component.getClass()))) {
        components.put(component.getClass(),component);
      }
    }
  }
  for (  Component component : components.values()) {
    componentCache.put(component.getClass(),component);
  }
}
