{
  pipeline.shutdown();
  unloadRequestTaskMaster.shutdown(new ChunkUnloadRequest());
  for (  Chunk chunk : nearCache.values()) {
    farStore.put(chunk);
    chunk.dispose();
  }
  nearCache.clear();
  farStore.dispose();
  String title=CoreRegistry.get(WorldProvider.class).getTitle();
  File chunkFile=new File(PathManager.getInstance().getCurrentWorldPath(),TerasologyConstants.WORLD_DATA_FILE);
  try {
    FileOutputStream fileOut=new FileOutputStream(chunkFile);
    BufferedOutputStream bos=new BufferedOutputStream(fileOut);
    ObjectOutputStream out=new ObjectOutputStream(bos);
    out.writeObject(farStore);
    out.close();
    bos.flush();
    bos.close();
    fileOut.close();
  }
 catch (  IOException e) {
    logger.error("Error saving chunks",e);
  }
}
