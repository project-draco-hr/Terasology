{
  pipeline.shutdown();
  unloadRequestTaskMaster.shutdown(new ChunkUnloadRequest());
  for (  Chunk chunk : nearCache.values()) {
    farStore.put(chunk);
    chunk.dispose();
  }
  nearCache.clear();
  farStore.dispose();
  Path chunkFile=PathManager.getInstance().getCurrentSavePath().resolve(TerasologyConstants.WORLD_DATA_FILE);
  try (BufferedOutputStream bos=new BufferedOutputStream(Files.newOutputStream(chunkFile));ObjectOutputStream out=new ObjectOutputStream(bos)){
    out.writeObject(farStore);
  }
 catch (  IOException e) {
    logger.error("Error saving chunks",e);
  }
}
