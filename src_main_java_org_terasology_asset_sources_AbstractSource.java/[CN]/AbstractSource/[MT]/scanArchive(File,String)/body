{
  ZipFile archive;
  String archiveType="zip";
  if (file.getName().endsWith(".jar")) {
    archive=new JarFile(file,false);
    archiveType="jar";
  }
 else {
    archive=new ZipFile(file);
  }
  Enumeration<? extends ZipEntry> lister=archive.entries();
  while (lister.hasMoreElements()) {
    ZipEntry entry=lister.nextElement();
    String entryPath=entry.getName();
    if (entryPath.startsWith(basePath)) {
      String key=(basePath != null) ? entryPath.substring(basePath.length() + 1) : entryPath;
      URL url=new URL(archiveType + ":file:" + file.getAbsolutePath()+ "!/"+ entryPath);
      AssetUri uri=getUri(key);
      if (uri != null) {
        assets.put(uri,url);
        assetsByType.put(uri.getAssetType(),uri);
      }
    }
  }
}
