{
  GameEngine gameEngine=CoreRegistry.get(GameEngine.class);
  EngineTime time=(EngineTime)CoreRegistry.get(Time.class);
  long startTime=time.getRawTimeInMs();
  while (current != null && time.getRawTimeInMs() - startTime < 20 && !gameEngine.hasPendingState()) {
    if (current.step()) {
      popStep();
    }
  }
  if (current == null) {
    nuiManager.closeScreen(loadingScreen);
    nuiManager.setHUDVisible(true);
    CoreRegistry.get(GameEngine.class).changeState(new StateIngame(gameManifest));
  }
 else {
    float progressValue=(progress + current.getExpectedCost() * current.getProgress()) / maxProgress;
    loadingScreen.updateStatus(current.getMessage(),progressValue);
    nuiManager.update(delta);
  }
}
