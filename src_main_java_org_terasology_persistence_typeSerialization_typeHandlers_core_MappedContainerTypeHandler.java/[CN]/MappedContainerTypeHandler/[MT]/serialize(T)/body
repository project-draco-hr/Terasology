{
  if (value == null) {
    return null;
  }
  EntityData.Value.Builder result=EntityData.Value.newBuilder();
  for (  Map.Entry<FieldMetadata<T,?>,TypeHandler<?>> entry : mappedFields.entrySet()) {
    Object val=entry.getKey().getValue(value);
    TypeHandler handler=entry.getValue();
    EntityData.Value fieldValue=handler.serialize(val);
    if (fieldValue != null) {
      result.addNameValue(EntityData.NameValue.newBuilder().setName(entry.getKey().getName()).setValue(fieldValue).build());
    }
  }
  return result.build();
}
