{
  logger.info("No existing identity, requesting one");
  byte[] preMasterSecret=new byte[IdentityConstants.PREMASTER_SECRET_LENGTH];
  new SecureRandom().nextBytes(preMasterSecret);
  byte[] encryptedPreMasterSecret=serverCertificate.encrypt(preMasterSecret);
  masterSecret=SecretGenerator.generate(preMasterSecret,SecretGenerator.MASTER_SECRET_LABEL,Bytes.concat(clientRandom,serverRandom),SecretGenerator.MASTER_SECRET_LENGTH);
  ctx.getChannel().write(NetData.NetMessage.newBuilder().setNewIdentityRequest(NetData.NewIdentityRequest.newBuilder().setPreMasterSecret(ByteString.copyFrom(encryptedPreMasterSecret)).setRandom(ByteString.copyFrom(clientRandom))).build());
  requestedCertificate=true;
}
