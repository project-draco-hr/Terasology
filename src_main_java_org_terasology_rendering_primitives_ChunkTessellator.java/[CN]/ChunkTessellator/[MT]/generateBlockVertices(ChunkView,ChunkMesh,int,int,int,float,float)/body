{
  Block block=view.getBlock(x,y,z);
  ChunkMesh.RENDER_TYPE renderType=ChunkMesh.RENDER_TYPE.TRANSLUCENT;
  if (!block.isTranslucent())   renderType=ChunkMesh.RENDER_TYPE.OPAQUE;
  if (block.getURI().toString().equals("engine:water") || block.getURI().toString().equals("engine:ice"))   renderType=ChunkMesh.RENDER_TYPE.WATER_AND_ICE;
  if (block.isDoubleSided())   renderType=ChunkMesh.RENDER_TYPE.BILLBOARD;
  if (block.getMeshPart(BlockPart.CENTER) != null) {
    Vector4f colorOffset=block.calcColorOffsetFor(BlockPart.CENTER,temp,hum);
    block.getMeshPart(BlockPart.CENTER).appendTo(mesh,x,y,z,colorOffset,renderType.getIndex());
  }
  boolean[] drawDir=new boolean[6];
  for (  Side side : Side.values()) {
    Vector3i offset=side.getVector3i();
    Block blockToCheck=view.getBlock(x + offset.x,y + offset.y,z + offset.z);
    drawDir[side.ordinal()]=isSideVisibleForBlockTypes(blockToCheck,block,side);
  }
  if (y == 0) {
    drawDir[Side.BOTTOM.ordinal()]=false;
  }
  if (block.isLiquid()) {
    for (    Side side : Side.horizontalSides()) {
      Vector3i offset=side.getVector3i();
      Block adjacentBelow=view.getBlock(x + offset.x,y - 1,z + offset.z);
      Block adjacent=view.getBlock(x + offset.x,y,z + offset.z);
      Block below=view.getBlock(x,y - 1,z);
      drawDir[side.ordinal()]|=(isSideVisibleForBlockTypes(adjacentBelow,block,side) && !isSideVisibleForBlockTypes(below,adjacent,side.reverse()));
    }
    Block blockToCheck=view.getBlock(x,y + 1,z);
    drawDir[Side.TOP.ordinal()]|=!blockToCheck.isLiquid();
    Block bottomBlock=view.getBlock(x,y - 1,z);
    if (bottomBlock.isLiquid() || bottomBlock.getId() == 0x0) {
      for (      Side dir : Side.values()) {
        if (drawDir[dir.ordinal()]) {
          Vector4f colorOffset=block.calcColorOffsetFor(BlockPart.fromSide(dir),temp,hum);
          block.getLoweredLiquidMesh(dir).appendTo(mesh,x,y,z,colorOffset,renderType.getIndex());
        }
      }
      return;
    }
  }
  for (  Side dir : Side.values()) {
    if (drawDir[dir.ordinal()]) {
      Vector4f colorOffset=block.calcColorOffsetFor(BlockPart.fromSide(dir),temp,hum);
      block.getMeshPart(BlockPart.fromSide(dir)).appendTo(mesh,x,y,z,colorOffset,renderType.getIndex());
    }
  }
}
