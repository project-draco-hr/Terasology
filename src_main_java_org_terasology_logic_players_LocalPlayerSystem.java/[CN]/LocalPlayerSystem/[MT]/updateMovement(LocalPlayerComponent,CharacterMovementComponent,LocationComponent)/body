{
  Vector3f relMove=new Vector3f(relativeMovement);
  relMove.y=0;
  if (characterMovementComponent.isGhosting || characterMovementComponent.isSwimming) {
    Quat4f viewRot=new Quat4f();
    QuaternionUtil.setEuler(viewRot,TeraMath.DEG_TO_RAD * localPlayerComponent.viewYaw,TeraMath.DEG_TO_RAD * localPlayerComponent.viewPitch,0);
    QuaternionUtil.quatRotate(viewRot,relMove,relMove);
    relMove.y+=relativeMovement.y;
  }
 else {
    QuaternionUtil.quatRotate(location.getLocalRotation(),relMove,relMove);
  }
  float lengthSquared=relMove.lengthSquared();
  if (lengthSquared > 1)   relMove.normalize();
  characterMovementComponent.setDrive(relMove);
}
