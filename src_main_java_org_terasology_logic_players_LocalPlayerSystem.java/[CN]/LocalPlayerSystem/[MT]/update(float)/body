{
  if (!localPlayer.isValid())   return;
  EntityRef entity=localPlayer.getCharacterEntity();
  LocalPlayerComponent localPlayerComponent=entity.getComponent(LocalPlayerComponent.class);
  CharacterMovementComponent characterMovementComponent=entity.getComponent(CharacterMovementComponent.class);
  CharacterComponent characterComp=entity.getComponent(CharacterComponent.class);
  LocationComponent location=entity.getComponent(LocationComponent.class);
  if (localPlayerComponent.isDead) {
    return;
  }
  updateMovement(localPlayerComponent,characterMovementComponent,location);
  Quat4f lookRotation=new Quat4f();
  QuaternionUtil.setEuler(lookRotation,TeraMath.DEG_TO_RAD * localPlayerComponent.viewYaw,TeraMath.DEG_TO_RAD * localPlayerComponent.viewPitch,0);
  updateCamera(characterComp,characterMovementComponent,location.getWorldPosition(),lookRotation);
  localPlayerComponent.handAnimation=Math.max(0,localPlayerComponent.handAnimation - 2.5f * delta);
  entity.saveComponent(characterMovementComponent);
  entity.saveComponent(localPlayerComponent);
}
