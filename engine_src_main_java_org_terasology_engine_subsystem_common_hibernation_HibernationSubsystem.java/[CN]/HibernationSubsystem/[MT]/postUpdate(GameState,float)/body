{
  if (hibernationManager.isHibernating()) {
    if (!hibernationManager.isHibernationAllowed() || displayDevice.hasFocus()) {
      hibernationManager.setHibernating(false);
      time.setPaused(pausedBeforeHibernation);
    }
  }
 else {
    if (hibernationManager.isHibernationAllowed() && !displayDevice.hasFocus()) {
      hibernationManager.setHibernating(true);
      pausedBeforeHibernation=time.isPaused();
      time.setPaused(true);
    }
  }
  if (hibernationManager.isHibernating()) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
      logger.warn("Hibernation sleep interrupted",e);
    }
  }
}
