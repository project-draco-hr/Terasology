{
  try {
    CoreRegistry.putPermanently(GameEngine.class,this);
    changeState(initialState);
    engineState=EngineState.RUNNING;
    Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
    mainLoop();
    cleanup();
  }
 catch (  RuntimeException e) {
    logger.error("Uncaught exception, attempting clean game shutdown",e);
    try {
      cleanup();
    }
 catch (    Throwable t) {
      logger.error("Clean game shutdown after an uncaught exception failed",t);
      logger.error("Rethrowing original exception");
    }
    throw e;
  }
}
