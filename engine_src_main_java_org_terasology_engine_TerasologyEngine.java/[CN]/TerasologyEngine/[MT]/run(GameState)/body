{
  try {
    CoreRegistry.putPermanently(GameEngine.class,this);
    if (!initialised) {
      init();
    }
    changeState(initialState);
    running=true;
    Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
    mainLoop();
    cleanup();
  }
 catch (  RuntimeException e) {
    logger.error("Uncaught exception, attempting clean game shutdown",e);
    try {
      cleanup();
    }
 catch (    RuntimeException innerE) {
      logger.error("Clean game shutdown after an uncaught exception failed",innerE);
      logger.error("Rethrowing original exception");
    }
    throw e;
  }
}
