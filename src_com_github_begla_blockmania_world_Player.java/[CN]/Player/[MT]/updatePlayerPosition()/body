{
  Vector3f oldPosition=VectorPool.getVector(_position);
  if (Configuration.getSettingBoolean("DEMO_FLIGHT") && Configuration.getSettingBoolean("GOD_MODE")) {
    _position.z+=Configuration.getSettingNumeric("WALKING_SPEED");
    int maxHeight=_parent.maxHeightAt((int)_position.x,(int)_position.z + 8) + 16;
    _position.y+=(maxHeight - _position.y) / 128f;
    if (_position.y > 128)     _position.y=128;
    if (_position.y < 40f)     _position.y=40f;
    return;
  }
  if (MathHelper.fastAbs(_acc.y) > 0f) {
    _acc.y+=-1f * _acc.y * Configuration.getSettingNumeric("FRICTION");
  }
  if (MathHelper.fastAbs(_acc.x) > 0f) {
    _acc.x+=-1f * _acc.x * Configuration.getSettingNumeric("FRICTION");
  }
  if (MathHelper.fastAbs(_acc.z) > 0f) {
    _acc.z+=-1f * _acc.z * Configuration.getSettingNumeric("FRICTION");
  }
  if (MathHelper.fastAbs(_acc.x) > _wSpeed || MathHelper.fastAbs(_acc.z) > _wSpeed || MathHelper.fastAbs(_acc.y) > _wSpeed) {
    double max=Math.max(Math.max(MathHelper.fastAbs(_acc.x),MathHelper.fastAbs(_acc.z)),MathHelper.fastAbs(_acc.y));
    double div=max / _wSpeed;
    _acc.x/=div;
    _acc.z/=div;
    _acc.y/=div;
  }
  _acc.x+=_movement.x;
  _acc.y+=_movement.y;
  _acc.z+=_movement.z;
  if (_gravity > -Configuration.getSettingNumeric("MAX_GRAVITY") && !Configuration.getSettingBoolean("GOD_MODE") && !_playerIsSwimming) {
    _gravity-=Configuration.getSettingNumeric("GRAVITY");
  }
  if (_gravity < -Configuration.getSettingNumeric("MAX_GRAVITY") && !Configuration.getSettingBoolean("GOD_MODE") && !_playerIsSwimming) {
    _gravity=-Configuration.getSettingNumeric("MAX_GRAVITY");
  }
  if (_gravity > -Configuration.getSettingNumeric("MAX_GRAVITY_SWIMMING") && !Configuration.getSettingBoolean("GOD_MODE") && _playerIsSwimming) {
    _gravity-=Configuration.getSettingNumeric("GRAVITY_SWIMMING");
  }
  if (_gravity < -Configuration.getSettingNumeric("MAX_GRAVITY_SWIMMING") && !Configuration.getSettingBoolean("GOD_MODE") && _playerIsSwimming) {
    _gravity=-Configuration.getSettingNumeric("MAX_GRAVITY_SWIMMING");
  }
  getPosition().y+=_acc.y;
  getPosition().y+=_gravity;
  if (!Configuration.getSettingBoolean("GOD_MODE")) {
    if (verticalHitTest(oldPosition)) {
      _gravity=0;
      if (_jump) {
        _jump=false;
        _gravity=Configuration.getSettingNumeric("JUMP_INTENSITY");
      }
      _playerIsTouchingGround=true;
    }
 else {
      _playerIsTouchingGround=false;
    }
  }
 else {
    _gravity=0f;
  }
  oldPosition.set(_position);
  getPosition().x+=_acc.x;
  getPosition().z+=_acc.z;
  if (!Configuration.getSettingBoolean("GOD_MODE")) {
    if (horizontalHitTest(oldPosition)) {
    }
  }
  VectorPool.putVector(oldPosition);
}
