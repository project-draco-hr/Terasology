{
  Vector3i blockPos=new Vector3i(x,y,z);
  WorldView worldView;
  if (LightingUtil.compareLightingPropagation(type,oldType) != PropagationComparison.IDENTICAL || type.getLuminance() != oldType.getLuminance()) {
    worldView=WorldView.createSubviewAroundBlock(blockPos,Chunk.MAX_LIGHT + 1,chunkProvider);
  }
 else {
    worldView=WorldView.createSubviewAroundBlock(blockPos,1,chunkProvider);
  }
  if (worldView != null) {
    worldView.lock();
    try {
      if (!worldView.setBlock(x,y,z,type,oldType)) {
        return false;
      }
      Region3i affected=new LightPropagator(worldView).update(x,y,z,type,oldType);
      if (affected.isEmpty()) {
        worldView.setDirtyAround(blockPos);
      }
 else {
        worldView.setDirtyAround(affected);
      }
      return true;
    }
  finally {
      worldView.unlock();
    }
  }
  return false;
}
