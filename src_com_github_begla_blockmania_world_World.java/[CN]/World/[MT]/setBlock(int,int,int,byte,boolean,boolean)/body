{
  int chunkPosX=calcChunkPosX(x) % Configuration.getSettingNumeric("V_DIST_X").intValue();
  int chunkPosZ=calcChunkPosZ(z) % Configuration.getSettingNumeric("V_DIST_Z").intValue();
  int blockPosX=calcBlockPosX(x,chunkPosX);
  int blockPosZ=calcBlockPosZ(z,chunkPosZ);
  Chunk c=_chunkCache.loadOrCreateChunk(calcChunkPosX(x),calcChunkPosZ(z));
  if (c == null) {
    return;
  }
  if (overwrite || c.getBlock(blockPosX,y,blockPosZ) == 0x0) {
    byte currentValue=getLight(x,y,z,Chunk.LIGHT_TYPE.SUN);
    if (Block.getBlockForType(c.getBlock(blockPosX,y,blockPosZ)).isRemovable()) {
      c.setBlock(blockPosX,y,blockPosZ,type);
    }
    if (update) {
      c.refreshSunlightAtLocalPos(blockPosX,blockPosZ,true,true);
      c.refreshLightAtLocalPos(blockPosX,y,blockPosZ,Chunk.LIGHT_TYPE.SUN);
      byte newValue=getLight(x,y,z,Chunk.LIGHT_TYPE.SUN);
      if (newValue > currentValue) {
        c.spreadLight(blockPosX,y,blockPosZ,newValue,Chunk.LIGHT_TYPE.SUN);
      }
      byte luminance=Block.getBlockForType(type).getLuminance();
      if (luminance > 0) {
        currentValue=getLight(x,y,z,Chunk.LIGHT_TYPE.BLOCK);
        c.setLight(blockPosX,y,blockPosZ,luminance,Chunk.LIGHT_TYPE.BLOCK);
        newValue=getLight(x,y,z,Chunk.LIGHT_TYPE.BLOCK);
        if (newValue > currentValue) {
          c.spreadLight(blockPosX,y,blockPosZ,luminance,Chunk.LIGHT_TYPE.BLOCK);
        }
      }
      c.refreshLightAtLocalPos(blockPosX,y,blockPosZ,Chunk.LIGHT_TYPE.BLOCK);
      _chunkUpdateManager.queueChunkForUpdate(c,true,false,false);
    }
  }
}
