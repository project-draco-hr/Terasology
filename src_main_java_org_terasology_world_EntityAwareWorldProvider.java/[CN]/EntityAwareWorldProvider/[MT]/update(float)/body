{
  int processed=0;
  PerformanceMonitor.startActivity("BlockChangedEventQueue");
  BlockChangedEvent event=eventQueue.poll();
  while (event != null) {
    logger.finer(String.format("%s: %s -> %s",event.getBlockPosition(),event.getOldType().getBlockFamily(),event.getNewType().getBlockFamily()));
    getOrCreateEntityAt(event.getBlockPosition()).send(event);
    if (processed++ >= 4) {
      break;
    }
    event=eventQueue.poll();
  }
  PerformanceMonitor.endActivity();
  PerformanceMonitor.startActivity("Temp Blocks Cleanup");
  for (  EntityRef entity : tempBlocks) {
    BlockComponent blockComp=entity.getComponent(BlockComponent.class);
    if (blockComp == null || !blockComp.temporary)     continue;
    HealthComponent healthComp=entity.getComponent(HealthComponent.class);
    if (healthComp == null || healthComp.currentHealth == healthComp.maxHealth) {
      entity.destroy();
    }
  }
  tempBlocks.clear();
  PerformanceMonitor.endActivity();
}
