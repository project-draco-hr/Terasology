{
  if (Thread.currentThread().equals(mainThread)) {
    Vector3i pos=new Vector3i(x,y,z);
    EntityRef blockEntity=getBlockEntityAt(pos);
    if (super.setBlock(x,y,z,type,oldType)) {
      if (type.isKeepActive()) {
        temporaryBlockEntities.remove(blockEntity);
      }
 else       if (oldType.isKeepActive() && isTemporaryBlock(blockEntity,type)) {
        temporaryBlockEntities.add(blockEntity);
      }
      EntityRef regionEntity=blockRegionLookup.get(pos);
      if (regionEntity != null) {
        regionEntity.send(new OnChangedBlock(pos,type,oldType));
      }
      updateBlockEntity(blockEntity,oldType,type);
      blockEntity.send(new OnChangedBlock(new Vector3i(x,y,z),type,oldType));
      return true;
    }
  }
 else {
    if (super.setBlock(x,y,z,type,oldType)) {
      eventQueue.add(new OnChangedBlock(new Vector3i(x,y,z),type,oldType));
      return true;
    }
  }
  return false;
}
