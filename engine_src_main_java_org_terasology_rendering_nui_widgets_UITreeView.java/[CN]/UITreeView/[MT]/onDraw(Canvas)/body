{
  updateListeners();
  canvas.setPart(TREE_ITEM);
  int currentHeight=0;
  for (int i=0; i < model.get().getItemCount(); i++) {
    Tree<T> item=model.get().getItem(i);
    TreeViewListenerSet treeViewListenerSet=treeViewListenerSets.get(i);
    ExpandButtonInteractionListener buttonListener=expandListeners.get(i);
    int itemHeight=canvas.getCurrentStyle().getMargin().grow(itemRenderer.getPreferredSize(item.getValue(),canvas).addX(item.getDepth() * itemIndent.get())).getY();
    Rect2i itemRegion=Rect2i.createFromMinAndSize((item.getDepth() + 1) * itemIndent.get(),currentHeight,canvas.size().x - (item.getDepth() + 1) * itemIndent.get(),itemHeight);
    if (!item.isLeaf()) {
      canvas.setPart(EXPAND_BUTTON);
      setButtonMode(canvas,item,buttonListener);
      Rect2i buttonRegion=Rect2i.createFromMinAndSize(item.getDepth() * itemIndent.get(),currentHeight,itemIndent.get(),itemHeight);
      drawButton(canvas,buttonRegion,buttonListener);
      canvas.setPart(TREE_ITEM);
    }
    if (alternativeWidgets.containsKey(i)) {
      canvas.drawWidget(alternativeWidgets.get(i),itemRegion);
      currentHeight+=itemHeight;
    }
 else {
      setItemMode(canvas,item,treeViewListenerSet);
      drawItem(canvas,itemRegion,item,treeViewListenerSet);
      currentHeight+=itemHeight;
      if (mouseOverItemIndex.get() != null && mouseOverItemIndex.get() == i) {
        drawDragHint(canvas,itemRegion);
      }
    }
  }
}
