{
  deltaToSave.getEntityDeltas().forEachEntry(new TLongObjectProcedure<EntityDelta>(){
    @Override public boolean execute(    long entityId,    EntityDelta delta){
      EntityRef entity=privateEntityManager.getEntity(entityId);
      for (      Component changedComponent : delta.getChangedComponents().values()) {
        entity.removeComponent(changedComponent.getClass());
        entity.addComponent(changedComponent);
      }
      for (      Class<? extends Component> c : delta.getRemovedComponents()) {
        entity.removeComponent(c);
      }
      return true;
    }
  }
);
  deltaToSave.getDestroyedEntities().forEach(new TLongProcedure(){
    @Override public boolean execute(    long entityId){
      privateEntityManager.getEntity(entityId).destroy();
      return true;
    }
  }
);
}
