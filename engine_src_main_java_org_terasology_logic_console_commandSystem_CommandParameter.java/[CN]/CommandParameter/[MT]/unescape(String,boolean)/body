{
  String string=rawParameter;
  List<String> params=new ArrayList<>();
  int i=0;
  while (i < string.length()) {
    char c=string.charAt(i);
    if (c == CommandParam.ARRAY_DELIMITER_ESCAPE_CHARACTER) {
      if (i >= string.length() - 1) {
        throw new CommandParameterParseException("The command parameter must not end with an escape character.",rawParameter);
      }
      string=string.substring(0,i) + string.substring(i + 1);
      char following=string.charAt(i);
      if (following != CommandParam.ARRAY_DELIMITER_ESCAPE_CHARACTER && (!split || following != arrayDelimiter)) {
        throw new CommandParameterParseException("Character '" + following + "' cannot be escaped.",rawParameter);
      }
      i++;
      continue;
    }
    if (split && c == arrayDelimiter) {
      String param=string.substring(0,i);
      string=string.substring(i + 1);
      i=0;
      params.add(param);
      continue;
    }
    i++;
  }
  if (string.length() > 0) {
    params.add(string);
  }
  return params;
}
