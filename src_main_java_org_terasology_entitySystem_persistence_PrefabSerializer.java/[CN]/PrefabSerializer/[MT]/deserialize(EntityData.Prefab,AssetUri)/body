{
  boolean persisted=(prefabData.hasPersisted()) ? prefabData.getPersisted() : true;
  Prefab parent=null;
  if (prefabData.hasParentName()) {
    AssetUri parentUri=new AssetUri(AssetType.PREFAB,prefabData.getParentName());
    if (parentUri.isValid()) {
      parent=Assets.get(parentUri,Prefab.class);
    }
  }
  Map<Class<? extends Component>,Component> componentMap=Maps.newHashMap();
  if (parent != null) {
    for (    Component comp : parent.iterateComponents()) {
      componentMap.put(comp.getClass(),componentLibrary.copy(comp));
    }
  }
  for (  String removedComponent : prefabData.getRemovedComponentList()) {
    ComponentMetadata<?> metadata=componentLibrary.getMetadata(removedComponent);
    if (metadata != null) {
      componentMap.remove(metadata.getType());
    }
  }
  for (  EntityData.Component componentData : prefabData.getComponentList()) {
    ComponentMetadata<?> metadata=componentLibrary.getMetadata(componentData.getType());
    if (metadata != null) {
      Component existing=componentMap.get(metadata.getType());
      if (existing != null) {
        componentSerializer.deserializeOnto(existing,componentData);
      }
 else {
        Component newComponent=componentSerializer.deserialize(componentData);
        if (newComponent != null) {
          componentMap.put(newComponent.getClass(),newComponent);
        }
      }
    }
  }
  return new PojoPrefab(uri,componentMap,parent,persisted);
}
